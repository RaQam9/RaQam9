<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- !! أضف هذا السطر هنا !! -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- كل الـ CSS style يبقى كما هو -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>المركز الرياضي - نسخة مستقرة</title>

    <!-- Google Analytics, Tailwind, Fonts, Font Awesome... -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05JCQWTWHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05JCQWTWHK');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { 'tajawal': ['Tajawal', 'sans-serif'] } } } }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- كل الـ CSS style يبقى كما هو -->
    <style>
        :root{--bg-color:#0d1117;--surface-color:#161b22;--primary-text-color:#c9d1d9;--secondary-text-color:#8b949e;--accent-color:#2f81f7;--border-color:#30363d;--success-color:#238636;--danger-color:#da3633;--warning-color:#f7b731;--channel-color:#facc15}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Tajawal',sans-serif;background-color:var(--bg-color);color:var(--primary-text-color);line-height:1.6;overflow-x:hidden}.page-container.hidden{display:none}#predictions-page .container{max-width:800px;margin:0 auto;padding:15px}#predictions-page header h1,#news-page header h1{text-align:center;font-size:1.8rem;margin-bottom:15px;font-weight:700;padding:15px 0}#predictions-page .floating-icon-container{position:fixed;bottom:20px;left:20px;display:flex;align-items:center;gap:8px;z-index:1001}#predictions-page .user-icon-button{background-color:var(--accent-color);color:white;width:45px;height:45px;border-radius:50%;border:none;font-size:1.2rem;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,.3)}#predictions-page .dismiss-icon-button{background-color:var(--surface-color);color:var(--secondary-text-color);width:28px;height:28px;border-radius:50%;border:1px solid var(--border-color);font-size:.9rem;display:flex;justify-content:center;align-items:center;cursor:pointer}#predictions-page .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);justify-content:center;align-items:center}#predictions-page .modal.show{display:flex}#predictions-page .modal-content{background-color:var(--surface-color);padding:25px;border-radius:12px;width:90%;max-width:450px;position:relative;border-top:4px solid var(--accent-color)}#predictions-page .modal-content h2{font-size:1.2rem;margin-bottom:20px;text-align:center}#predictions-page .modal .form-control input{width:100%;padding:10px;background-color:var(--border-color);color:var(--primary-text-color);border:1px solid var(--border-color);border-radius:6px}#predictions-page .modal .form-control{margin-bottom:15px}#predictions-page .modal button{width:100%;padding:12px;background-color:var(--accent-color);color:white;border:none;border-radius:8px;cursor:pointer}#predictions-page .close-button{position:absolute;top:15px;right:15px;color:var(--secondary-text-color);font-size:24px;cursor:pointer}#predictions-page .news-ticker{background-color:var(--surface-color);border-radius:8px;padding:10px 15px;margin-bottom:25px;display:flex;align-items:center;overflow:hidden;border:1px solid var(--border-color)}#predictions-page .ticker-icon{color:var(--accent-color);font-size:1.2rem;margin-left:15px}#predictions-page .ticker-content{white-space:nowrap;animation:ticker-scroll-rtl 25s linear infinite}@keyframes ticker-scroll-rtl{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}#predictions-page .ticker-item{display:inline-block;margin-right:50px;font-size:.9rem;color:var(--secondary-text-color)}.date-tabs-container{display:flex;width:100%;border-radius:8px;overflow:hidden;background-color:var(--surface-color);margin-bottom:20px;border:1px solid var(--border-color)}.date-tab{flex-grow:1;text-align:center;padding:12px 10px;cursor:pointer;color:var(--secondary-text-color);border-bottom:4px solid transparent;transition:all .2s;font-weight:700;font-size:1.1rem}.date-tab.active{color:var(--primary-text-color);background-color:rgba(47,129,247,.15);border-bottom-color:var(--accent-color)}.day-content{display:none}.day-content.active{display:block;animation:fadeIn .5s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}#predictions-page .match-card{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:8px;overflow:hidden;margin-bottom:15px}#predictions-page .match-header{padding:10px 15px;display:flex;justify-content:space-between;align-items:center;background-color:rgba(47,129,247,.1)}#predictions-page .match-league{font-weight:700;color:var(--accent-color)}#predictions-page .match-date-time{font-size:.9rem;color:var(--secondary-text-color)}#predictions-page .match-body{padding:20px}#predictions-page .teams-row{display:flex;justify-content:space-around;align-items:center;margin-bottom:20px}#predictions-page .team{text-align:center;width:120px}#predictions-page .team img{width:50px;height:50px;object-fit:contain;margin-bottom:10px}#predictions-page .team-name{font-weight:700;font-size:1rem}#predictions-page .match-status-container{text-align:center}#predictions-page .match-time{font-size:1.2rem;font-weight:700;direction:ltr}#predictions-page .match-status{font-size:1rem;font-weight:700;padding:4px 8px;border-radius:6px}#predictions-page .match-status.soon{color:white;background-color:var(--success-color)}#predictions-page .match-status.live{color:white;background-color:var(--warning-color);animation:pulse 1.5s infinite}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(247,183,49,.7)}70%{box-shadow:0 0 0 10px rgba(247,183,49,0)}100%{box-shadow:0 0 0 0 rgba(247,183,49,0)}}#predictions-page .match-status.ended{color:white;background-color:var(--danger-color)}#predictions-page .prediction-form,#predictions-page .comment-form{background-color:var(--bg-color);padding:15px;border-radius:8px;border:1px solid var(--border-color)}#predictions-page .prediction-form.disabled{opacity:.6;pointer-events:none}#predictions-page .form-group{margin-bottom:15px}#predictions-page .form-group legend{font-size:1rem;font-weight:500;color:var(--secondary-text-color);margin-bottom:10px;display:flex;align-items:center;gap:8px}#predictions-page .channel-info span{color:var(--channel-color);font-weight:700}#predictions-page .prediction-options{display:flex;gap:10px}#predictions-page .prediction-options input[type=radio]{display:none}#predictions-page .prediction-options label{flex-grow:1;padding:10px;border-radius:6px;border:1px solid var(--border-color);text-align:center;cursor:pointer;transition:all .2s}#predictions-page .prediction-options input[type=radio]:checked+label{background-color:var(--success-color);border-color:var(--success-color);color:#fff;font-weight:700}#predictions-page .scorer-input{width:100%;padding:10px;background-color:var(--border-color);color:var(--primary-text-color);border:1px solid var(--border-color);border-radius:6px}#predictions-page .submit-btn{width:100%;padding:12px;background-color:var(--accent-color);color:white;border:none;border-radius:8px;font-size:1.1rem;font-weight:700;cursor:pointer;display:flex;justify-content:center;align-items:center;gap:8px}#predictions-page .submit-btn:disabled{background-color:var(--success-color);opacity:.8;cursor:not-allowed}#predictions-page .submit-btn.error{background-color:var(--danger-color)}#predictions-page .match-footer{padding:0 20px 20px}#predictions-page .toggle-comments-btn{width:100%;padding:10px;background:transparent;border:1px solid var(--border-color);color:var(--secondary-text-color);cursor:pointer;border-radius:8px;margin-top:15px}#predictions-page .toggle-comments-btn:disabled{opacity:.6;cursor:not-allowed}#predictions-page .comments-section{display:none;margin-top:15px}#predictions-page .comment-list{margin-bottom:15px;max-height:200px;overflow-y:auto}#predictions-page .comment{display:flex;gap:10px;margin-bottom:15px}#predictions-page .comment-avatar{width:35px;height:35px;border-radius:50%;background-color:var(--border-color);display:flex;justify-content:center;align-items:center}#predictions-page .comment-body{flex:1}#predictions-page .comment-author{font-weight:700}#predictions-page .comment-text{font-size:.9rem;color:var(--secondary-text-color)}#predictions-page .comment-form textarea{width:100%;min-height:60px;padding:10px;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:6px;resize:vertical;margin-bottom:10px}#predictions-page .comment-form button{padding:8px 15px;background-color:var(--accent-color);color:white;border:none;border-radius:6px;cursor:pointer}#predictions-page .fa-spin{animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#news-page{height:calc(100vh - 70px)}#news-page .page{position:absolute;top:0;left:0;width:100%;height:100%;padding:15px;padding-top:0;overflow-y:auto;background-color:var(--bg-color);transition:transform .35s ease-in-out;display:flex;flex-direction:column}#news-page #home-page{transform:translateX(0);z-index:10}#news-page #article-page{transform:translateX(100%);z-index:20;touch-action:pan-y}#news-page #article-content{padding-top:15px;padding-bottom:10px}#news-page #article-header{display:flex;justify-content:space-between;align-items:flex-start;gap:15px;margin-bottom:10px}#news-page #article-header h1{font-size:1.8rem;flex-grow:1;line-height:1.4}#news-page #share-button{background:0 0;border:none;color:var(--secondary-text-color);font-size:1.5rem;cursor:pointer;padding:5px}#news-page #article-content img{width:100%;max-height:400px;object-fit:cover;border-radius:8px;margin-bottom:20px}#news-page #article-content p{font-size:1.1rem;line-height:1.8;margin-bottom:15px;color:var(--secondary-text-color)}#news-page .comments-section{padding:20px 0;margin-top:25px;border-top:1px solid var(--border-color)}#news-page .comments-section h2{font-size:1.5rem;margin-bottom:20px}#news-page .comment-item{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:8px;padding:15px;margin-bottom:10px;position:relative}#news-page .comment-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;color:var(--secondary-text-color);font-size:.9rem;flex-wrap:wrap}#news-page .comment-author{font-weight:700}#news-page .comment-body{font-size:1rem;line-height:1.7;white-space:pre-wrap;word-wrap:break-word}#news-page .delete-comment-btn{position:absolute;top:10px;left:10px;background:0 0;border:none;color:var(--secondary-text-color);cursor:pointer;font-size:.9rem;transition:color .2s;padding:5px}#news-page .delete-comment-btn:hover{color:var(--danger-color)}#news-page #comment-form input,#news-page #comment-form textarea{width:100%;padding:12px;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:8px;color:var(--primary-text-color);margin-bottom:10px;font-size:1rem}#news-page #comment-form button{width:100%;background-color:var(--accent-color);color:white;border:none;cursor:pointer;font-weight:700;padding:12px;border-radius:8px;font-size:1rem;transition:background-color .2s}#news-page #comment-form button:disabled{background-color:var(--secondary-text-color);cursor:not-allowed}#news-page #articles-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;padding-bottom:80px}#news-page .article-card{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;position:relative}#news-page .article-card img{width:100%;height:180px;object-fit:cover}#news-page .article-card .article-title{padding:15px;font-size:1.1rem;font-weight:700;flex-grow:1}#exit-toast,#notification-toast{position:fixed;bottom:-100px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.8);color:white;padding:10px 20px;border-radius:20px;z-index:2000;font-size:.9rem;transition:bottom .3s ease-in-out;box-shadow:0 4px 12px rgba(0,0,0,.2)}#exit-toast.show,#notification-toast.show{bottom:30px}
    </style>
</head>
<body class="bg-[#0d1117]">
<!-- ======================================================= -->
<!-- !! NETLIFY FORMS - GHOST FORMS FOR DETECTION !! -->
<!-- ======================================================= -->
<div style="display:none;">
    <!-- نموذج التوقعات -->
    <form name="prediction-form" netlify netlify-honeypot="bot-field">
        <input type="text" name="match_name" />
        <input type="text" name="league" />
        <input type="radio" name="winner" />
        <input type="text" name="scorer" />
        <input type="text" name="username" />
        <input type="text" name="social_account" />
    </form>

    <!-- نموذج التعليقات على المباريات -->
    <form name="match-comment-form" netlify netlify-honeypot="bot-field">
        <input type="text" name="match_name" />
        <textarea name="comment_text"></textarea>
        <input type="text" name="username" />
        <input type="text" name="social_account" />
    </form>
</div>
    <nav class="bg-[#161b22] border-b border-[#30363d] p-3 sticky top-0 z-50">
        <div class="container mx-auto flex justify-center items-center gap-4">
            <button id="nav-predictions-btn" class="nav-btn bg-blue-600 text-white px-6 py-2 rounded-md font-bold transition-all"><i class="fa-solid fa-trophy ml-2"></i> توقعات المباريات</button>
            <button id="nav-news-btn" class="nav-btn text-gray-400 px-6 py-2 rounded-md font-bold transition-all"><i class="fa-solid fa-newspaper ml-2"></i> أخبار كرة القدم</button>
        </div>
    </nav>
    
    <div id="predictions-page" class="page-container">
        <div class="container">
            <header><h1><i class="fa-solid fa-trophy"></i> توقعات المباريات</h1></header>
            <div class="news-ticker"><i class="fa-solid fa-bell ticker-icon"></i><div class="ticker-content" id="predictions-ticker-content"></div></div>
            <main id="matches-container">
                <div class="date-tabs-container" id="date-tabs"></div>
                <div id="days-content-container"></div>
            </main>
        </div>
        <div class="floating-icon-container" id="floating-icon-container"><button class="dismiss-icon-button" id="dismiss-icon-btn" title="إخفاء الأيقونة"><i class="fa-solid fa-xmark"></i></button><button class="user-icon-button" id="user-icon-btn" title="بيانات المستخدم"><i class="fa-solid fa-user-pen"></i></button></div>
        <div class="modal" id="user-modal"><div class="modal-content"><span class="close-button" id="close-modal-btn">×</span><h2>بيانات المستخدم</h2><form id="user-info-form"><div class="form-control"><label for="username">اسم المستخدم</label><input type="text" id="username" name="username" required></div><div class="form-control"><label for="social_account">حساب التواصل (اختياري)</label><input type="text" id="social_account" name="social_account" placeholder="e.g., @username"></div><button type="submit">حفظ البيانات</button><div id="save-status" style="text-align:center; margin-top:10px;"></div></form></div></div>
    </div>

    <div id="news-page" class="page-container hidden relative">
        <div id="home-page" class="page"><header><h1><i class="fa-solid fa-newspaper"></i> أخبار كرة القدم</h1></header><main id="articles-grid"></main></div>
        <div id="article-page" class="page"><div id="article-content"></div><div id="comments-section" class="comments-section"><h2><i class="fa-solid fa-comments"></i> التعليقات</h2><div id="comments-list"></div><form id="comment-form" name="news-comment-form" data-netlify="true">
            <input type="hidden" name="form-name" value="news-comment-form" />
            <input type="hidden" id="article-title-hidden-input" name="article_title" value="" />
            <h3>أضف تعليقك</h3>
            <input type="text" id="comment-name" name="comment_name" placeholder="اسمك (اختياري)">
            <textarea id="comment-text" name="comment_text" placeholder="اكتب تعليقك هنا..." required></textarea>
            <button type="submit" id="submit-comment-btn">إرسال التعليق</button>
        </form></div></div>
        <div id="notification-toast"></div>
        <div id="exit-toast">انقر مرة أخرى للخروج</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const predictionsBtn = document.getElementById('nav-predictions-btn');
            const newsBtn = document.getElementById('nav-news-btn');
            const predictionsPage = document.getElementById('predictions-page');
            const newsPage = document.getElementById('news-page');
            function switchPage(pageToShow) { 
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'select_content', {
                        'content_type': 'tab',
                        'item_id': pageToShow
                    });
                }
                if (pageToShow === 'predictions') { predictionsPage.classList.remove('hidden'); newsPage.classList.add('hidden'); predictionsBtn.classList.add('bg-blue-600', 'text-white'); predictionsBtn.classList.remove('text-gray-400'); newsBtn.classList.remove('bg-blue-600', 'text-white'); newsBtn.classList.add('text-gray-400'); } else { newsPage.classList.remove('hidden'); predictionsPage.classList.add('hidden'); newsBtn.classList.add('bg-blue-600', 'text-white'); newsBtn.classList.remove('text-gray-400'); predictionsBtn.classList.remove('bg-blue-600', 'text-white'); predictionsBtn.classList.add('text-gray-400'); } 
            }
            predictionsBtn.addEventListener('click', () => switchPage('predictions'));
            newsBtn.addEventListener('click', () => switchPage('news'));
            initializePredictionsPage();
            initializeNewsPage();
        });

               // ======================================================================
        // SECTION 1: PREDICTIONS PAGE LOGIC (Supabase Version)
        // ======================================================================
        async function initializePredictionsPage() {
            // --- إعدادات الاتصال بـ Supabase (معلوماتك هنا) ---
            const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';

            // إنشاء اتصال مع Supabase
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            try {
                // عرض مؤشر التحميل للمستخدم
                const container = document.getElementById('matches-container');
                container.innerHTML = '<p class="text-center text-gray-400 mt-8"><i class="fa-solid fa-spinner fa-spin mr-2"></i> جاري تحميل المباريات...</p>';

                // هذا هو الجزء الذي يجلب البيانات من الإنترنت
                let { data: matchesDataFromDB, error } = await supabaseClient
                    .from('matches') 
                    .select('*')
                    .order('datetime', { ascending: true });

                if (error) {
                    throw error;
                }
                
                // تنسيق البيانات لتناسب بقية الكود
                const formattedMatches = matchesDataFromDB.map(match => ({
                    id: match.id,
                    team1: { name: match.team1_name, logo: match.team1_logo },
                    team2: { name: match.team2_name, logo: match.team2_logo },
                    league: match.league,
                    datetime: match.datetime,
                    channels: match.channels || []
                }));

                // إرسال البيانات التي تم جلبها إلى الدالة الرئيسية للعرض
                initializeAppWithData(formattedMatches);

                        } catch (error) {
                // (النسخة الجديدة) تسجيل الخطأ وعرض تفاصيله مباشرة على الشاشة
                console.error("Could not fetch matches from Supabase:", error);
                const container = document.getElementById('matches-container');
                if (container) {
                    // تحويل كائن الخطأ إلى نص لعرضه
                    const errorMessage = JSON.stringify(error, null, 2);
                    container.innerHTML = `
                        <div class="text-center text-red-500 mt-8 p-4 border border-red-500 rounded-md">
                            <p class="font-bold mb-2">حدث خطأ تقني!</p>
                            <p class="mb-4">هذه هي تفاصيل الخطأ التي ستساعدنا على حل المشكلة:</p>
                            <pre style="text-align: left; direction: ltr; background: #161b22; color: #c9d1d9; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word;">${errorMessage}</pre>
                        </div>
                    `;
                }
            }
	};
        function initializeAppWithData(matchesData) {
            const tickerMessages = ["🏆 سيتم تكريم أفضل المتوقعين في نهاية كل أسبوع!", "💡 تأكد من حفظ بياناتك للمشاركة في السحب.", "🔥 تابعونا في تغطية خاصة لمباريات كأس العالم للأندية."];
            
            const dateTabsContainer = document.getElementById('date-tabs');
            const daysContentContainer = document.getElementById('days-content-container');
            const tickerContent = document.getElementById('predictions-ticker-content');
            const floatingIconContainer = document.getElementById('floating-icon-container');

            function getMatchStatus(matchDateStr) { const matchDate = new Date(matchDateStr); const now = new Date(); const diffMinutes = (matchDate.getTime() - now.getTime()) / 60000; if (diffMinutes < -125) return { state: 'ended' }; if (diffMinutes <= 0) return { state: 'live' }; if (diffMinutes <= 5) return { state: 'soon' }; return { state: 'scheduled' }; }
            
            function renderMatchesForDay(dayContentContainer, matches) { 
                dayContentContainer.innerHTML = ''; 
                if (!matches || matches.length === 0) return;
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                matches.forEach(match => { 
                    const matchDate = new Date(match.datetime); 
                    const dateString = matchDate.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' }).replace(/[٠-٩]/g, d => numMap[d]);
                    const timeString = matchDate.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true }).replace(/[٠-٩]/g, d => numMap[d]);
                    const statusInfo = getMatchStatus(match.datetime); 
                    let statusDisplay; 
                    switch (statusInfo.state) { 
                        case 'ended': statusDisplay = `<span class="match-status ended">انتهت</span>`; break; 
                        case 'live': statusDisplay = `<span class="match-status live">مباشر</span>`; break; 
                        case 'soon': statusDisplay = `<span class="match-status soon">بعد قليل</span>`; break; 
                        default: statusDisplay = `<div class="match-time">${timeString}</div>`; 
                    } 
                    const channels = (match.channels && match.channels.length > 0) ? match.channels.join(' / ') : "غير محددة"; 
                    const isMatchOver = statusInfo.state === 'ended'; 
                    const card = document.createElement('div'); 
                    card.className = 'match-card'; 
                    card.dataset.matchId = match.id; 
                    const matchName = `${match.team1.name} vs ${match.team2.name}`;
                    card.innerHTML = `
                        <div class="match-header"><span class="match-league">${match.league}</span><span class="match-date-time">${dateString}</span></div>
                        <div class="match-body">
                            <div class="teams-row">
                                <div class="team"><img src="${match.team1.logo}" alt="${match.team1.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team1.name}</span></div>
                                <div class="match-status-container">${statusDisplay}</div>
                                <div class="team"><img src="${match.team2.logo}" alt="${match.team2.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team2.name}</span></div>
                            </div>
                            <form name="prediction-form" class="prediction-form ${isMatchOver ? 'disabled' : ''}" data-netlify="true">
                                <input type="hidden" name="form-name" value="prediction-form" />
                                <input type="hidden" name="match_name" value="${matchName}" />
                                <input type="hidden" name="league" value="${match.league}" />
                                <div class="form-group">
                                    <legend class="channel-info"><i class="fa-solid fa-tv"></i> <span>${channels}</span></legend>
                                </div>
                                <div class="form-group">
                                    <legend>توقع النتيجة:</legend>
                                    <div class="prediction-options">
                                        <input type="radio" name="winner" id="win1-${match.id}" value="${match.team1.name}" required><label for="win1-${match.id}">${match.team1.name}</label>
                                        <input type="radio" name="winner" id="draw-${match.id}" value="تعادل"><label for="draw-${match.id}">تعادل</label>
                                        <input type="radio" name="winner" id="win2-${match.id}" value="${match.team2.name}"><label for="win2-${match.id}">${match.team2.name}</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <legend>من سيسجل أولاً؟ (اختياري)</legend>
                                    <input type="text" name="scorer" class="scorer-input" placeholder="اكتب اسم اللاعب...">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="submit-btn">${isMatchOver ? 'أغلقت التوقعات' : 'إرسال التوقع'}</button>
                                </div>
                            </form>
                        </div>
                        <div class="match-footer">
                            <button class="toggle-comments-btn" ${isMatchOver ? 'disabled' : ''}>💬 التعليقات</button>
                            <div class="comments-section" style="display:none;">
                                <div class="comment-list"></div>
                                <form name="match-comment-form" class="comment-form" data-netlify="true">
                                    <input type="hidden" name="form-name" value="match-comment-form" />
                                    <input type="hidden" name="match_name" value="${matchName}" />
                                    <textarea name="comment_text" placeholder="أضف تعليقك..." required></textarea>
                                    <button type="submit">إرسال</button>
                                </form>
                            </div>
                        </div>
                    `; 
                    dayContentContainer.appendChild(card); 
                }); 
            }

            function attachTabEventListeners() { 
                const dateTabsContainer = document.getElementById('date-tabs');
                dateTabsContainer.addEventListener('click', (e) => { 
                    if (!e.target.classList.contains('date-tab')) return; 
                    const tabId = e.target.dataset.tabId; 
                    document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active')); 
                    e.target.classList.add('active'); 
                    document.querySelectorAll('.day-content').forEach(content => content.classList.remove('active')); 
                    document.getElementById(`day-${tabId}`).classList.add('active'); 
                }); 
            }
            
            function attachMatchEventListeners() { 
                const daysContentContainer = document.getElementById('days-content-container');
                const userIconBtn = document.getElementById('user-icon-btn'); 
                const dismissIconBtn = document.getElementById('dismiss-icon-btn'); 
                const closeModalBtn = document.getElementById('close-modal-btn'); 
                const userModal = document.getElementById('user-modal'); 
                const userInfoForm = document.getElementById('user-info-form'); 
                userIconBtn.addEventListener('click', openUserModal); 
                dismissIconBtn.addEventListener('click', dismissFloatingIcon); 
                closeModalBtn.addEventListener('click', closeUserModal); 
                userModal.addEventListener('click', (e) => { if (e.target === userModal) closeUserModal(); }); 
                userInfoForm.addEventListener('submit', saveUserInfo); 
                daysContentContainer.addEventListener('submit', e => { 
                    e.preventDefault();
                    if (e.target.classList.contains('prediction-form') || e.target.classList.contains('comment-form')) { 
                        handleFormSubmit(e.target); 
                    }
                }); 
                daysContentContainer.addEventListener('click', e => { 
                    if (e.target.classList.contains('toggle-comments-btn')) handleToggleComments(e.target); 
                }); 
            }

            function openUserModal() { document.getElementById('user-modal').classList.add('show'); }
            function closeUserModal() { document.getElementById('user-modal').classList.remove('show'); }
            function dismissFloatingIcon() { document.getElementById('floating-icon-container').classList.add('hidden'); sessionStorage.setItem('isIconDismissed', 'true'); }
            
            function saveUserInfo(e) { 
                e.preventDefault(); 
                const userModal = document.getElementById('user-modal'); 
                const saveStatus = document.getElementById('save-status'); 
                const userInfo = { username: userModal.querySelector('#username').value.trim(), social: userModal.querySelector('#social_account').value.trim() }; 
                if (!userInfo.username) { alert('الرجاء إدخال اسم المستخدم.'); return; } 
                localStorage.setItem('userInfo', JSON.stringify(userInfo)); 
                saveStatus.textContent = 'تم الحفظ ✅'; 
                setTimeout(() => { saveStatus.textContent = ''; closeUserModal(); }, 1500); 
            }
            
            function loadUserInfo() { const userInfo = JSON.parse(localStorage.getItem('userInfo')); if (userInfo) { document.getElementById('username').value = userInfo.username || ''; document.getElementById('social_account').value = userInfo.social || ''; } }
            
            function populateTicker() { 
                const tickerContent = document.getElementById('predictions-ticker-content');
                tickerContent.innerHTML = tickerMessages.map(msg => `<span class="ticker-item">${msg}</span>`).join(''); 
            }
            
            function handleFormSubmit(form) {
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
                submitBtn.disabled = true;

                const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
                const formData = new FormData(form);
                formData.append('username', userInfo.username || 'مجهول');
                formData.append('social_account', userInfo.social || 'لا يوجد');

                fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                })
                .then(() => {
                    if (form.classList.contains('prediction-form')) {
                        submitBtn.innerHTML = `تم الإرسال ✅`;
                        [...form.elements].forEach(el => el.disabled = true);
                        const matchCard = form.closest('.match-card');
                        const prediction = { 
                            winner: form.querySelector('input[name="winner"]:checked').value,
                            scorer: form.querySelector('input[name="scorer"]').value.trim() 
                        };
                        localStorage.setItem(`prediction-${matchCard.dataset.matchId}`, JSON.stringify(prediction));
                    } else if (form.classList.contains('comment-form')) {
                        submitBtn.innerHTML = "إرسال";
                        submitBtn.disabled = false;
                        const matchCard = form.closest('.match-card');
                        const commentList = form.closest('.comments-section').querySelector('.comment-list');
                        const commentText = form.querySelector('textarea').value;
                        const commentData = { author: userInfo.username || 'مجهول', text: commentText };
                        addCommentToDOM(commentList, commentData);
                        const comments = JSON.parse(localStorage.getItem(`comments-${matchCard.dataset.matchId}`) || '[]');
                        comments.push(commentData);
                        localStorage.setItem(`comments-${matchCard.dataset.matchId}`, JSON.stringify(comments));
                        form.querySelector('textarea').value = '';
                    }
                })
                .catch((error) => {
                    alert('حدث خطأ. الرجاء المحاولة مرة أخرى.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            }

            function handleToggleComments(button) { const commentsSection = button.nextElementSibling; const isHidden = commentsSection.style.display === 'none' || !commentsSection.style.display; commentsSection.style.display = isHidden ? 'block' : 'none'; button.innerHTML = isHidden ? '💬 إخفاء التعليقات' : '💬 التعليقات'; }
            
            function addCommentToDOM(commentList, commentData) { 
                const newComment = document.createElement('div'); 
                newComment.className = 'comment'; 
                newComment.innerHTML = `<div class="comment-avatar"><i class="fa-solid fa-user"></i></div><div class="comment-body"><span class="comment-author">${commentData.author}</span><p class="comment-text">${commentData.text}</p></div>`; 
                commentList.appendChild(newComment); 
            }
            
            function loadFromStorage() { 
                document.querySelectorAll('.match-card').forEach(card => { 
                    const matchId = card.dataset.matchId; 
                    const savedPrediction = localStorage.getItem(`prediction-${matchId}`); 
                    if (savedPrediction) { 
                        const prediction = JSON.parse(savedPrediction); 
                        const form = card.querySelector('.prediction-form'); 
                        const winnerInput = form.querySelector(`input[value="${prediction.winner}"]`); 
                        if (winnerInput) winnerInput.checked = true; 
                        form.querySelector('.scorer-input').value = prediction.scorer; 
                        [...form.elements].forEach(el => el.disabled = true); 
                        form.querySelector('.submit-btn').innerHTML = 'تم الإرسال ✅'; 
                    } 
                    const savedComments = JSON.parse(localStorage.getItem(`comments-${matchId}`) || '[]'); 
                    const commentList = card.querySelector('.comment-list'); 
                    savedComments.forEach(comment => addCommentToDOM(commentList, comment)); 
                }); 
            }
            
            // تهيئة التطبيق بالبيانات الثابتة
            loadUserInfo();
            populateTicker();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const upcomingMatchesData = matchesData.filter(match => new Date(new Date(match.datetime).toLocaleDateString('fr-CA')) >= today);
            const matchesByDay = upcomingMatchesData.reduce((acc, match) => { const dayKey = new Date(match.datetime).toLocaleDateString('fr-CA'); if (!acc[dayKey]) acc[dayKey] = []; acc[dayKey].push(match); return acc; }, {});
            
            if (Object.keys(matchesByDay).length === 0) {
                daysContentContainer.innerHTML = `<p class="text-center text-gray-400 mt-8">لا توجد مباريات قادمة. يرجى التحقق لاحقًا.</p>`;
            } else {
                const sortedDays = Object.keys(matchesByDay).sort();
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                sortedDays.forEach((day, index) => {
                    const dayDate = new Date(day + 'T00:00:00Z');
                    const tabTitle = dayDate.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' }).replace(/[٠-٩]/g, d => numMap[d]);
                    const tabButton = document.createElement('div');
                    tabButton.className = `date-tab ${index === 0 ? 'active' : ''}`;
                    tabButton.textContent = tabTitle;
                    tabButton.dataset.tabId = day;
                    dateTabsContainer.appendChild(tabButton);
                    const dayContentDiv = document.createElement('div');
                    dayContentDiv.className = `day-content ${index === 0 ? 'active' : ''}`;
                    dayContentDiv.id = `day-${day}`;
                    daysContentContainer.appendChild(dayContentDiv);
                    const statusOrder = { 'live': 1, 'soon': 2, 'scheduled': 3, 'ended': 4 };
                    const sortedMatches = matchesByDay[day].sort((a, b) => {
                        const statusA = getMatchStatus(a.datetime).state;
                        const statusB = getMatchStatus(b.datetime).state;
                        if (statusOrder[statusA] !== statusOrder[statusB]) return statusOrder[statusA] - statusOrder[statusB];
                        return new Date(a.datetime) - new Date(b.datetime);
                    });
                    renderMatchesForDay(dayContentDiv, sortedMatches);
                });
            }
            
            attachTabEventListeners();
            attachMatchEventListeners();
            loadFromStorage();
        }

        // ==========================================================
        // SECTION 2: NEWS PAGE LOGIC (STABLE VERSION)
        // ==========================================================
        function initializeNewsPage() {
            const ADMIN_PASSWORD = '1122';  
            
            const getTodaysDateString = (offsetDays = 0) => {
                const today = new Date();
                today.setDate(today.getDate() - offsetDays);
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            };
            
            let articlesData = [
{
  "id": 6,
  "title": "مبابي يعود.. والظهور الأول يقترب!",
  "image": "https://a.top4top.io/p_3463f03ts0.jpg",
  "publishDate": "2025-06-25",
  "badge": "hot",
  "fullText": "<p>عاد النجم الفرنسي كيليان مبابي إلى التدريبات الجماعية مع ريال مدريد بعد تعافيه من الوعكة الصحية التي أبعدته عن الفريق خلال الأيام الماضية.</p><p>المهاجم العائد ظهر في أجواء مليئة بالحماس والتركيز، ضمن استعدادات الفريق للمشاركة في كأس العالم للأندية، حيث يتطلّع لظهوره الأول بقميص الميرينغي.</p><p>المدرب تشابي ألونسو بدا حذرًا في التعامل مع مبابي، لكنه أشار إلى إمكانية الدفع به تدريجيًا في المباريات القادمة، مؤكدًا أنه سيكون عنصرًا حاسمًا في مشوار الفريق.</p><p>جماهير ريال مدريد تترقّب اللحظة التي سيرتدي فيها مبابي القميص الأبيض رسميًا داخل الملعب، خاصة وأن التعاقد معه كان الحلم الأكبر للمدريديين منذ سنوات.</p><p>كل الأنظار تتجه الآن نحو أول مباراة للفريق في البطولة، فهل يبدأ تشابي بمفاجأة ويُشرك مبابي منذ البداية؟</p>"
},
                { "id": 5, "title": "إستيفاو ويليان.. أكثر لاعب محظوظ في العالم!", "image": "https://f.top4top.io/p_3462yrvqf0.jpg", "publishDate": "2025-06-24", "badge": "hot", "fullText": "<p>في مباراة ودّية جمعت بالميراس البرازيلي وإنتر ميامي الأميركي، خطف النجم الشاب إستيفاو ويليان الأضواء بلقطة لن ينساها طيلة مسيرته.</p><p>ويليان، الذي لم يتجاوز 17 عامًا بعد، استغل فرصة مشاركته أمام أساطير اللعبة ليقوم بتبادل القمصان مع ليونيل ميسي بين شوطي اللقاء، وسط دهشة الجماهير.</p><p>لكن المفاجأة الأكبر كانت عقب نهاية المباراة، عندما توجّه مباشرة إلى لويس سواريز وتبادل القميص معه أيضًا، ليجمع بين قميصي اثنين من أعظم اللاعبين في تاريخ كرة القدم.</p><p>هذه اللحظة الاستثنائية انتشرت كالنار في الهشيم عبر مواقع التواصل، واعتبرها كثيرون دليلاً على أن النجم الصاعد يعيش حلمًا لا يعيشه سوى القلائل.</p><p>الصحافة البرازيلية وصفت الأمر بأنه \"أسبوع الأحلام\" لإستيفاو، فيما بدأ المتابعون يتساءلون: هل هو مجرد محظوظ؟ أم نجم قادم بقوة؟</p>" },
                { "id": 4, "title": "سان جيرمان يتصدر.. وأتلتيكو مدريد خارج المونديال!", "image": "https://e.top4top.io/p_3461all000.jpg", "publishDate": "2025-06-23", "badge": "hot", "fullText": "<p>انتهت منافسات المجموعة الثانية في كأس العالم للأندية بنتائج مثيرة ومفاجآت مدوية، أبرزها خروج أتلتيكو مدريد من الدور الأول رغم امتلاكه نفس عدد النقاط كالمتصدرين.</p><p>النجم المغربي أشرف حكيمي قاد فريقه باريس سان جيرمان إلى الفوز الأخير الذي ضمن الصدارة بفارق الأهداف، بعد أداء قوي وتألق واضح في الجبهة اليمنى.</p><p>في المقابل، تأهل بوتافوجو البرازيلي إلى دور الـ16 رغم الخسارة، مستفيدًا من تفوقه على أتلتيكو مدريد بفارق الأهداف الإيجابي، في واحدة من أكثر السيناريوهات إثارة هذا الموسم.</p><p>أما أتلتيكو، فقد دفع ثمن البداية الضعيفة، حيث لم يشفع له الفوز الأخير بسبب فارق الأهداف السلبي الذي أبقاه في المركز الثالث برصيد 6 نقاط.</p><p>سياتل الأمريكي كان الحلقة الأضعف في المجموعة، حيث ودّع البطولة دون أي نقطة بعد ثلاث هزائم متتالية وفارق أهداف كبير بلغ -5.</p>" },
                { "id": 10, "title": "كابرال يرد: 'چيان لعِين' ليست عنصرية!", "image": "https://b.top4top.io/p_3461gr2b90.jpg", "publishDate": "2025-06-23", "badge": "hot", "fullText": "<p>في واحدة من أبرز لقطات كأس العالم للأندية، التقطت الكاميرات مواجهة نارية بين أنطونيو روديجر وجوستافو كابرال، بعد أن بدا أن الأول شعر بإهانة عنصرية وجهها له لاعب باتشوكا.</p><p>ردّ كابرال جاء سريعًا عبر تصريح مثير، قال فيه: 'الحكم أشار بالعنصرية، وأنا واصلت تكرار ما قلته لروديجر چيان لعِين، ولم يكن هناك أي عنصرية في ذلك، كما نقولها في الأرجنتين، إنها مجرد كلمة.'</p><p>العبارة التي استخدمها كابرال تُعد شائعة في الأرجنتين، وتُقال أحيانًا داخل الملاعب للتعبير عن التوتر أو الغضب، دون نية عنصرية، لكنها قد تحمل معانٍ مختلفة في ثقافات أخرى، ما تسبب في سوء الفهم.</p><p>الجماهير تفاعلت بقوة مع المشهد، بين من يرى أن على اللاعبين احترام اختلاف الخلفيات، ومن يدافع عن كابرال مؤكدين أنه لم يقصد الإساءة، خاصة وأن روديجر معروف بحساسيته تجاه قضايا العنصرية بعد تجارب مؤلمة سابقة.</p><p>الحادثة تفتح مجددًا ملف التواصل بين الثقافات في الملاعب الدولية، وتؤكد أن كرة القدم، رغم كونها عالمية، تحتاج إلى حساسية مضاعفة تجاه ما يُقال داخل المستطيل الأخضر.</p>" },
                { "id": 3, "title": "الهلال يقترب من حسم صفقة تيو هيرنانديز", "image": "https://j.top4top.io/p_3461lgsle0.jpg", "fullText": "<p>أكد الصحفي الموثوق فابريزيو رومانو أن نادي الهلال السعودي بات قريبًا للغاية من التوقيع مع النجم الفرنسي تيو هيرنانديز، الظهير الأيسر لنادي ميلان الإيطالي. المفاوضات دخلت مراحلها النهائية بعد أن وافق اللاعب على الشروط الشخصية.</p><p>الهلال أبدى جدية كبيرة في المفاوضات، حيث قدم عرضًا مغريًا لميلان يتجاوز 70 مليون يورو، وهو ما جعل النادي الإيطالي يدرس العرض بجدية، خاصة في ظل حاجته لتمويل صفقات أخرى. تيو هيرنانديز يُعد من أفضل اللاعبين في مركزه خلال السنوات الأخيرة، وساهم بشكل كبير في تتويج ميلان بلقب الدوري الإيطالي موسم 2021-2022. في حال إتمام الصفقة، سيُشكل تيو إضافة نوعية لدفاع وهجوم الهلال في الموسم المقبل الذي يشهد مشاركات عالمية.</p>" },
                { "id": 7, "title": "ديكو: نيكو ويليامز يرغب في برشلونة وسنسعى للتوقيع معه", "image": "https://c.top4top.io/p_3460d0wq31.jpg", "fullText": `<p>في تصريح أشعل حماس جماهير برشلونة، أكد ديكو، المدير الرياضي للنادي، أن النجم الإسباني نيكو ويليامز أبدى رغبة واضحة في ارتداء قميص البلوجرانا. وقال ديكو: "نيكو لاعب كبير، وكل الأندية الكبرى تريده. نحن نعلم أنه يفضل مشروعنا وسنحاول إيجاد صيغة مناسبة للتوقيع معه".</p><p>ويليامز، الذي يمتلك شرطًا جزائيًا في عقده مع أتلتيك بلباو يقدر بحوالي 58 مليون يورو، يُعتبر هدفًا رئيسيًا للمدرب هانزي فليك لتعزيز مركز الجناح الأيسر. الصفقة قد تعتمد على قدرة برشلونة على بيع بعض اللاعبين أولاً لتحقيق التوازن المالي المطلوب وفقًا لقواعد اللعب المالي النظيف في الليغا.</p>`},
                { "id": 2, "title": "الأساطير لا تموت.. راموس وسيلفا يتألقان", "image": "https://e.top4top.io/p_34592f0l51.jpg", "fullText": `<p>في زمن تُقاس فيه كرة القدم بالسرعة واللياقة البدنية، يواصل الثنائي الأسطوري سيرجيو راموس وتياجو سيلفا كتابة فصولٍ مدهشة في مسيرتهما. راموس، بعد عودته لإشبيلية، أثبت أنه لا يزال صخرة دفاعية يُعتمد عليها، بينما قاد سيلفا دفاع تشيلسي بخبرته الكبيرة.</p><p>كلاهما تجاوز الـ37 من العمر، لكنهما يقدمان أداءً يفوق العديد من اللاعبين الشبان، مما يطرح تساؤلاً حول سر استمراريتهما في أعلى المستويات. الانضباط، الشغف، والخبرة هي العوامل الرئيسية التي تجعل من هذين اللاعبين نموذجًا يُحتذى به في عالم كرة القدم.</p>`},
                { "id": 1, "title": "البرازيل تُعلن ترشحها لاستضافة كأس العالم للأندية 2029", "image": "https://h.top4top.io/p_3459a7zx00.jpg", "fullText": `<p>في إعلان رسمي لفت الأنظار، كشف الاتحاد البرازيلي لكرة القدم عن نيته الترشح لاستضافة النسخة الثانية من كأس العالم للأندية بصيغتها الجديدة عام 2029. ويأتي هذا الإعلان ليعكس الرغبة الكبيرة لدى البرازيل في استضافة الأحداث الرياضية الكبرى مجددًا.</p><p>يعتمد الملف البرازيلي على البنية التحتية القوية التي خلفتها استضافة كأس العالم 2014، بالإضافة إلى الشغف الجماهيري الكبير بكرة القدم. وتواجه البرازيل منافسة محتملة من ملفات أخرى قد تتقدم بها دول من أوروبا وآسيا، مما ينبئ بسباق مثير على نيل شرف التنظيم.</p>`},
                { "id": 4, "title": "مشاكل لامين يامال النسائية تتصدر العناوين!", "image": "https://f.top4top.io/p_3459o9rcs0.jpg", "fullText": `<p>تداولت وسائل الإعلام خلال الساعات الأخيرة تصريحات متبادلة بين نجم برشلونة الشاب لامين يامال و"كلوديا بافيل"، عارضة أزياء وممثلة معروفة، بعد مزاعم بعلاقة سابقة بين الطرفين. بدأت القصة عندما نشرت بافيل تلميحات حول علاقتها بلاعب كرة قدم شاب، وهو ما فسره المتابعون بأنه لامين يامال.</p><p>من جانبه، نفى يامال عبر وكيله أي علاقة له بالأمر، مؤكدًا أن تركيزه منصب بالكامل على مسيرته الكروية مع برشلونة والمنتخب الإسباني. هذه الأحداث تثير الجدل حول تأثير الشهرة المبكرة على اللاعبين الشبان وكيفية تعاملهم مع الضغوط الإعلامية والشخصية.</p>`},
                { "id": 5, "title": "أندية أمريكا الجنوبية تفرض هيمنتها في مونديال الأندية", "image": "https://f.top4top.io/p_3459firs50.jpg", "fullText": `<p>في أداء لافت، واصلت أندية أمريكا الجنوبية كتابة سطور التحدي في كأس العالم للأندية 2025، بعد أن خاضت تسع مباريات دون أن تتذوق طعم الهزيمة. أندية مثل فلامنغو، بالميراس، وريفر بليت قدمت مستويات فنية عالية وأظهرت قدرة كبيرة على مجاراة الأندية الأوروبية.</p><p>هذا الأداء يعكس التطور الكبير في مستوى الأندية في أمريكا الجنوبية، وقدرتها على الاحتفاظ بنجومها لفترات أطول. المحللون يرون أن هذه النسخة من البطولة قد تشهد بطلاً من خارج القارة الأوروبية لأول مرة منذ سنوات طويلة، مما يزيد من إثارة المنافسة.</p>`}
            ];

            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const tenDaysInMs = 10 * 24 * 60 * 60 * 1000;
            articlesData = articlesData.filter(article => {
                if (!article.publishDate) return true;
                const publishDate = new Date(article.publishDate);
                const timeDiff = today.getTime() - publishDate.getTime();
                return timeDiff <= tenDaysInMs;
            });

            const newsHomePage = document.querySelector('#news-page #home-page'); 
            const newsArticlePage = document.querySelector('#news-page #article-page'); 
            const articlesGrid = document.querySelector('#news-page #articles-grid'); 
            const articleContent = document.querySelector('#news-page #article-content'); 
            const notificationToast = document.querySelector('#news-page #notification-toast'); 
            const exitToast = document.getElementById('exit-toast'); 
            let currentArticleId = null; 
            let currentNewsSubPage = 'home';
            let firstBackPressTime = 0;

            function showToast(message, type = 'success', duration = 3000) { notificationToast.textContent = message; notificationToast.className = `show ${type}`; setTimeout(() => { notificationToast.classList.remove('show'); }, duration); }
            function navigateToNewsSubPage(pageName) { currentNewsSubPage = pageName; if (pageName === 'article') { newsHomePage.style.transform = 'translateX(-100%)'; newsArticlePage.style.transform = 'translateX(0)'; } else { newsHomePage.style.transform = 'translateX(0)'; newsArticlePage.style.transform = 'translateX(100%)'; } }
            
            function showArticle(articleId) {
                const article = articlesData.find(a => a.id === articleId);
                if (!article) return;
                currentArticleId = article.id;
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'view_item', { 'item_name': article.title });
                }

                articleContent.innerHTML = `
                    <div id="article-header">
                        <h1>${article.title}</h1>
                        <button id="share-button" title="مشاركة الخبر"><i class="fa-solid fa-share-nodes"></i></button>
                    </div>
                    <img src="${article.image}" alt="${article.title}">
                    ${article.fullText}
                `;
                document.getElementById('article-title-hidden-input').value = article.title;
                
                document.getElementById('share-button').addEventListener('click', () => {
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'share', { 'method': 'Native/Clipboard', 'content_type': 'article', 'item_id': article.title });
                    }
                    const shareData = { title: article.title, text: `شاهد هذا الخبر: ${article.title}`, url: window.location.href };
                    if (navigator.share) {
                        navigator.share(shareData).catch(console.error);
                    } else {
                        navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(() => showToast('تم نسخ رابط الخبر!')).catch(err => alert('فشل نسخ الرابط.'));
                    }
                });
                
                loadComments(currentArticleId); 
                newsArticlePage.scrollTop = 0; 
                navigateToNewsSubPage('article'); 
            }

            function buildHomePage() { articlesGrid.innerHTML = ''; articlesData.forEach(article => { const card = document.createElement('div'); card.className = 'article-card'; card.innerHTML = `<img src="${article.image}" alt="${article.title}"><div class="article-title"><h3>${article.title}</h3></div>`; card.addEventListener('click', () => showArticle(article.id)); articlesGrid.appendChild(card); }); }
            
            function loadComments(articleId) { 
                const commentsList = document.querySelector('#news-page #comments-list'); 
                const comments = JSON.parse(localStorage.getItem(`comments_${articleId}`)) || []; 
                commentsList.innerHTML = ''; 
                if (comments.length === 0) { commentsList.innerHTML = '<p style="color: var(--secondary-text-color); text-align: center;">لا توجد تعليقات. كن أول من يعلق!</p>'; return; } 
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                comments.slice().reverse().forEach(comment => { 
                    const commentElement = document.createElement('div'); 
                    commentElement.className = 'comment-item'; 
                    const safeAuthor = document.createTextNode(comment.name || 'مجهول').textContent; 
                    const safeText = document.createTextNode(comment.text).textContent; 
                    const commentDate = new Date(comment.date).toLocaleString('ar-EG', { dateStyle: 'short', timeStyle: 'short' }).replace(/[٠-٩]/g, d => numMap[d]);
                    commentElement.innerHTML = `<button class="delete-comment-btn" onclick="handleNewsDeleteComment(${articleId}, '${comment.date}')" title="حذف التعليق"><i class="fa-solid fa-trash"></i></button><div class="comment-header"><span class="comment-author">${safeAuthor}</span><span class="comment-date">${commentDate}</span></div><p class="comment-body">${safeText}</p>`; 
                    commentsList.appendChild(commentElement); 
                }); 
            }

            function handleNewsCommentSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const nameInput = document.getElementById('comment-name');
                const textInput = document.getElementById('comment-text');
                const submitBtn = document.getElementById('submit-comment-btn');
                const name = nameInput.value.trim();
                const text = textInput.value.trim();
                if (!text) return;

                submitBtn.disabled = true;
                submitBtn.textContent = 'جارِ الإرسال...';
                
                const formData = new FormData(form);
                fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                })
                .then(() => {
                    const comments = JSON.parse(localStorage.getItem(`comments_${currentArticleId}`)) || [];
                    const newComment = { name: name || 'مجهول', text: text, date: new Date().toISOString() };
                    comments.push(newComment);
                    localStorage.setItem(`comments_${currentArticleId}`, JSON.stringify(comments));
                    loadComments(currentArticleId);
                    showToast('تم إرسال تعليقك بنجاح!');
                })
                .catch(error => {
                    showToast('فشل إرسال التعليق.', 'error');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'إرسال التعليق';
                    nameInput.value = '';
                    textInput.value = '';
                });
            }

            window.handleNewsDeleteComment = function(articleId, commentDate) { 
                const password = prompt("للتحقق، يرجى إدخال كلمة مرور المدير:"); 
                if (password === ADMIN_PASSWORD) { 
                    let comments = JSON.parse(localStorage.getItem(`comments_${articleId}`)) || []; 
                    comments = comments.filter(c => c.date !== commentDate); 
                    localStorage.setItem(`comments_${articleId}`, JSON.stringify(comments)); 
                    loadComments(articleId); 
                    showToast('تم حذف التعليق بنجاح.'); 
                } else if (password !== null) { 
                    alert("كلمة المرور غير صحيحة!"); 
                } 
            }
            
            document.querySelector('#news-page #comment-form').addEventListener('submit', handleNewsCommentSubmit);
            
            let touchStartX = 0; 
            let isSwiping = false;
            newsArticlePage.addEventListener('touchstart', e => {
                if (e.changedTouches[0].screenX < 50 || e.changedTouches[0].screenX > window.innerWidth - 50) {
                    touchStartX = e.changedTouches[0].screenX;
                    isSwiping = true;
                }
            });
            newsArticlePage.addEventListener('touchend', e => {
                if (!isSwiping) return;
                isSwiping = false;
                const touchEndX = e.changedTouches[0].screenX;
                const swipeDistance = Math.abs(touchEndX - touchStartX);
                if (swipeDistance > 75) {
                    navigateToNewsSubPage('home');
                }
            });

            document.addEventListener('backbutton', (e) => {
                e.preventDefault();
                const newsPage = document.getElementById('news-page');
                if (!newsPage.classList.contains('hidden') && currentNewsSubPage === 'article') {
                    navigateToNewsSubPage('home');
                } else {
                    if (new Date().getTime() - firstBackPressTime < 2000) {
                        if (navigator.app && navigator.app.exitApp) { navigator.app.exitApp(); }
                    } else {
                        firstBackPressTime = new Date().getTime();
                        exitToast.classList.add('show');
                        setTimeout(() => { exitToast.classList.remove('show'); }, 2000);
                    }
                }
            }, false);

            buildHomePage();
        }
    </script>
</body>
</html>
