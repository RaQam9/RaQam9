<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ - Ù†Ø³Ø®Ø© Ù…Ø³ØªÙ‚Ø±Ø©</title>
    
    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { 'tajawal': ['Tajawal', 'sans-serif'] } } } }
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05JCQWTWHK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05JCQWTWHK');
    </script>
    
    <!-- CSS Styles -->
    <style>
        :root{--bg-color:#0d1117;--surface-color:#161b22;--primary-text-color:#c9d1d9;--secondary-text-color:#8b949e;--accent-color:#2f81f7;--border-color:#30363d;--success-color:#238636;--danger-color:#da3633;--warning-color:#f7b731;--channel-color:#facc15}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Tajawal',sans-serif;background-color:var(--bg-color);color:var(--primary-text-color);line-height:1.6;overflow-x:hidden}.page-container.hidden{display:none}#predictions-page .container{max-width:800px;margin:0 auto;padding:15px}#predictions-page header h1,#news-page header h1{text-align:center;font-size:1.8rem;margin-bottom:15px;font-weight:700;padding:15px 0}#predictions-page .floating-icon-container{position:fixed;bottom:20px;left:20px;display:flex;align-items:center;gap:8px;z-index:1001}#predictions-page .user-icon-button{background-color:var(--accent-color);color:white;width:45px;height:45px;border-radius:50%;border:none;font-size:1.2rem;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,.3)}#predictions-page .dismiss-icon-button{background-color:var(--surface-color);color:var(--secondary-text-color);width:28px;height:28px;border-radius:50%;border:1px solid var(--border-color);font-size:.9rem;display:flex;justify-content:center;align-items:center;cursor:pointer}#predictions-page .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);justify-content:center;align-items:center}#predictions-page .modal.show{display:flex}#predictions-page .modal-content{background-color:var(--surface-color);padding:25px;border-radius:12px;width:90%;max-width:450px;position:relative;border-top:4px solid var(--accent-color)}#predictions-page .modal-content h2{font-size:1.2rem;margin-bottom:20px;text-align:center}#predictions-page .modal .form-control input{width:100%;padding:10px;background-color:var(--border-color);color:var(--primary-text-color);border:1px solid var(--border-color);border-radius:6px}#predictions-page .modal .form-control{margin-bottom:15px}#predictions-page .modal button{width:100%;padding:12px;background-color:var(--accent-color);color:white;border:none;border-radius:8px;cursor:pointer}#predictions-page .close-button{position:absolute;top:15px;right:15px;color:var(--secondary-text-color);font-size:24px;cursor:pointer}#predictions-page .news-ticker{background-color:var(--surface-color);border-radius:8px;padding:10px 15px;margin-bottom:25px;display:flex;align-items:center;overflow:hidden;border:1px solid var(--border-color)}#predictions-page .ticker-icon{color:var(--accent-color);font-size:1.2rem;margin-left:15px}#predictions-page .ticker-content{white-space:nowrap;animation:ticker-scroll-rtl 25s linear infinite}@keyframes ticker-scroll-rtl{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}#predictions-page .ticker-item{display:inline-block;margin-right:50px;font-size:.9rem;color:var(--secondary-text-color)}.date-tabs-container{display:flex;width:100%;border-radius:8px;overflow:hidden;background-color:var(--surface-color);margin-bottom:20px;border:1px solid var(--border-color)}.date-tab{flex-grow:1;text-align:center;padding:12px 10px;cursor:pointer;color:var(--secondary-text-color);border-bottom:4px solid transparent;transition:all .2s;font-weight:700;font-size:1.1rem}.date-tab.active{color:var(--primary-text-color);background-color:rgba(47,129,247,.15);border-bottom-color:var(--accent-color)}.day-content{display:none}.day-content.active{display:block;animation:fadeIn .5s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}#predictions-page .match-card{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:8px;overflow:hidden;margin-bottom:15px}#predictions-page .match-header{padding:10px 15px;display:flex;justify-content:space-between;align-items:center;background-color:rgba(47,129,247,.1)}#predictions-page .match-league{font-weight:700;color:var(--accent-color)}#predictions-page .match-date-time{font-size:.9rem;color:var(--secondary-text-color)}#predictions-page .match-body{padding:20px}#predictions-page .teams-row{display:flex;justify-content:space-around;align-items:center;margin-bottom:20px}#predictions-page .team{text-align:center;width:120px}#predictions-page .team img{width:50px;height:50px;object-fit:contain;margin-bottom:10px}#predictions-page .team-name{font-weight:700;font-size:1rem}#predictions-page .match-status-container{text-align:center}#predictions-page .match-time{font-size:1.2rem;font-weight:700;direction:ltr}#predictions-page .match-status{font-size:1rem;font-weight:700;padding:4px 8px;border-radius:6px}#predictions-page .match-status.soon{color:white;background-color:var(--success-color)}#predictions-page .match-status.live{color:white;background-color:var(--warning-color);animation:pulse 1.5s infinite}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(247,183,49,.7)}70%{box-shadow:0 0 0 10px rgba(247,183,49,0)}100%{box-shadow:0 0 0 0 rgba(247,183,49,0)}}#predictions-page .match-status.ended{color:white;background-color:var(--danger-color)}#predictions-page .prediction-form,#predictions-page .comment-form{background-color:var(--bg-color);padding:15px;border-radius:8px;border:1px solid var(--border-color)}#predictions-page .prediction-form.disabled{opacity:.6;pointer-events:none}#predictions-page .form-group{margin-bottom:15px}#predictions-page .form-group legend{font-size:1rem;font-weight:500;color:var(--secondary-text-color);margin-bottom:10px;display:flex;align-items:center;gap:8px}#predictions-page .channel-info span{color:var(--channel-color);font-weight:700}#predictions-page .prediction-options{display:flex;gap:10px}#predictions-page .prediction-options input[type=radio]{display:none}#predictions-page .prediction-options label{flex-grow:1;padding:10px;border-radius:6px;border:1px solid var(--border-color);text-align:center;cursor:pointer;transition:all .2s}#predictions-page .prediction-options input[type=radio]:checked+label{background-color:var(--success-color);border-color:var(--success-color);color:#fff;font-weight:700}#predictions-page .scorer-input{width:100%;padding:10px;background-color:var(--border-color);color:var(--primary-text-color);border:1px solid var(--border-color);border-radius:6px}#predictions-page .submit-btn{width:100%;padding:12px;background-color:var(--accent-color);color:white;border:none;border-radius:8px;font-size:1.1rem;font-weight:700;cursor:pointer;display:flex;justify-content:center;align-items:center;gap:8px}#predictions-page .submit-btn:disabled{background-color:var(--success-color);opacity:.8;cursor:not-allowed}#predictions-page .submit-btn.error{background-color:var(--danger-color)}#predictions-page .match-footer{padding:0 20px 20px}#predictions-page .toggle-comments-btn{width:100%;padding:10px;background:transparent;border:1px solid var(--border-color);color:var(--secondary-text-color);cursor:pointer;border-radius:8px;margin-top:15px}#predictions-page .toggle-comments-btn:disabled{opacity:.6;cursor:not-allowed}#predictions-page .comments-section{display:none;margin-top:15px}#predictions-page .comment-list{margin-bottom:15px;max-height:200px;overflow-y:auto}#predictions-page .comment{display:flex;gap:10px;margin-bottom:15px}#predictions-page .comment-avatar{width:35px;height:35px;border-radius:50%;background-color:var(--border-color);display:flex;justify-content:center;align-items:center}#predictions-page .comment-body{flex:1}#predictions-page .comment-author{font-weight:700}#predictions-page .comment-text{font-size:.9rem;color:var(--secondary-text-color)}#predictions-page .comment-form textarea{width:100%;min-height:60px;padding:10px;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:6px;resize:vertical;margin-bottom:10px}#predictions-page .comment-form button{padding:8px 15px;background-color:var(--accent-color);color:white;border:none;border-radius:6px;cursor:pointer}#predictions-page .fa-spin{animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#news-page{height:calc(100vh - 70px)}#news-page .page{position:absolute;top:0;left:0;width:100%;height:100%;padding:15px;padding-top:0;overflow-y:auto;background-color:var(--bg-color);transition:transform .35s ease-in-out;display:flex;flex-direction:column}#news-page #home-page{transform:translateX(0);z-index:10}#news-page #article-page{transform:translateX(100%);z-index:20;touch-action:pan-y}#news-page #article-content{padding-top:15px;padding-bottom:10px}#news-page #article-header{display:flex;justify-content:space-between;align-items:flex-start;gap:15px;margin-bottom:10px}#news-page #article-header h1{font-size:1.8rem;flex-grow:1;line-height:1.4}#news-page #share-button{background:0 0;border:none;color:var(--secondary-text-color);font-size:1.5rem;cursor:pointer;padding:5px}#news-page #article-content img{width:100%;max-height:400px;object-fit:cover;border-radius:8px;margin-bottom:20px}#news-page #article-content p{font-size:1.1rem;line-height:1.8;margin-bottom:15px;color:var(--secondary-text-color)}#news-page .comments-section{padding:20px 0;margin-top:25px;border-top:1px solid var(--border-color)}#news-page .comments-section h2{font-size:1.5rem;margin-bottom:20px}#news-page .comment-item{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:8px;padding:15px;margin-bottom:10px;position:relative}#news-page .comment-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;color:var(--secondary-text-color);font-size:.9rem;flex-wrap:wrap}#news-page .comment-author{font-weight:700}#news-page .comment-body{font-size:1rem;line-height:1.7;white-space:pre-wrap;word-wrap:break-word}#news-page .delete-comment-btn{position:absolute;top:10px;left:10px;background:0 0;border:none;color:var(--secondary-text-color);cursor:pointer;font-size:.9rem;transition:color .2s;padding:5px}#news-page .delete-comment-btn:hover{color:var(--danger-color)}#news-page #comment-form input,#news-page #comment-form textarea{width:100%;padding:12px;background-color:var(--bg-color);border:1px solid var(--border-color);border-radius:8px;color:var(--primary-text-color);margin-bottom:10px;font-size:1rem}#news-page #comment-form button{width:100%;background-color:var(--accent-color);color:white;border:none;cursor:pointer;font-weight:700;padding:12px;border-radius:8px;font-size:1rem;transition:background-color .2s}#news-page #comment-form button:disabled{background-color:var(--secondary-text-color);cursor:not-allowed}#news-page #articles-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;padding-bottom:80px}#news-page .article-card{background-color:var(--surface-color);border:1px solid var(--border-color);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;position:relative}#news-page .article-card img{width:100%;height:180px;object-fit:cover}#news-page .article-card .article-title{padding:15px;font-size:1.1rem;font-weight:700;flex-grow:1}#exit-toast,#notification-toast{position:fixed;bottom:-100px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.8);color:white;padding:10px 20px;border-radius:20px;z-index:2000;font-size:.9rem;transition:bottom .3s ease-in-out;box-shadow:0 4px 12px rgba(0,0,0,.2)}#exit-toast.show,#notification-toast.show{bottom:30px}
    </style>
</head>
<body class="bg-[#0d1117]">
    <!-- Ghost forms for Netlify (can be removed if not used) -->
    <div style="display:none;">
        <form name="news-comment-form" netlify netlify-honeypot="bot-field">
            <input type="text" name="article_title" />
            <input type="text" name="comment_name" />
            <textarea name="comment_text"></textarea>
        </form>
    </div>

    <!-- Navigation Bar -->
    <nav class="bg-[#161b22] border-b border-[#30363d] p-3 sticky top-0 z-50">
        <div class="container mx-auto flex justify-center items-center gap-4">
            <button id="nav-predictions-btn" class="nav-btn bg-blue-600 text-white px-6 py-2 rounded-md font-bold transition-all"><i class="fa-solid fa-trophy ml-2"></i> ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</button>
            <button id="nav-news-btn" class="nav-btn text-gray-400 px-6 py-2 rounded-md font-bold transition-all"><i class="fa-solid fa-newspaper ml-2"></i> Ø£Ø®Ø¨Ø§Ø± ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</button>
        </div>
    </nav>

    <!-- Predictions Page -->
    <div id="predictions-page" class="page-container">
        <div class="container">
            <header><h1><i class="fa-solid fa-trophy"></i> ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h1></header>
            <div class="news-ticker"><i class="fa-solid fa-bell ticker-icon"></i><div class="ticker-content" id="predictions-ticker-content"></div></div>
            <main id="matches-container">
                <!-- Content is loaded by JavaScript -->
            </main>
        </div>
        <div class="floating-icon-container" id="floating-icon-container"><button class="dismiss-icon-button" id="dismiss-icon-btn" title="Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©"><i class="fa-solid fa-xmark"></i></button><button class="user-icon-button" id="user-icon-btn" title="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"><i class="fa-solid fa-user-pen"></i></button></div>
        <div class="modal" id="user-modal"><div class="modal-content"><span class="close-button" id="close-modal-btn">Ã—</span><h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2><form id="user-info-form"><div class="form-control"><label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input type="text" id="username" name="username" required></div><div class="form-control"><label for="social_account">Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ§ØµÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input type="text" id="social_account" name="social_account" placeholder="e.g., @username"></div><button type="submit">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button><div id="save-status" style="text-align:center; margin-top:10px;"></div></form></div></div>
    </div>
    
    <!-- News Page -->
    <div id="news-page" class="page-container hidden relative">
        <div id="home-page" class="page"><header><h1><i class="fa-solid fa-newspaper"></i> Ø£Ø®Ø¨Ø§Ø± ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</h1></header><main id="articles-grid"></main></div>
        <div id="article-page" class="page"><div id="article-content"></div><div id="comments-section" class="comments-section"><h2><i class="fa-solid fa-comments"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h2><div id="comments-list"></div><form id="comment-form" name="news-comment-form">
            <input type="hidden" id="article-title-hidden-input" name="article_title" value="" />
            <h3>Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ</h3>
            <input type="text" id="comment-name" name="comment_name" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <textarea id="comment-text" name="comment_text" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..." required></textarea>
            <button type="submit" id="submit-comment-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
        </form></div></div>
        <div id="notification-toast"></div>
        <div id="exit-toast">Ø§Ù†Ù‚Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø®Ø±ÙˆØ¬</div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const predictionsBtn = document.getElementById('nav-predictions-btn');
        const newsBtn = document.getElementById('nav-news-btn');
        const predictionsPage = document.getElementById('predictions-page');
        const newsPage = document.getElementById('news-page');
        function switchPage(pageToShow) { 
            if (typeof gtag !== 'undefined') { gtag('event', 'select_content', { 'content_type': 'tab', 'item_id': pageToShow }); }
            if (pageToShow === 'predictions') { predictionsPage.classList.remove('hidden'); newsPage.classList.add('hidden'); predictionsBtn.classList.add('bg-blue-600', 'text-white'); predictionsBtn.classList.remove('text-gray-400'); newsBtn.classList.remove('bg-blue-600', 'text-white'); newsBtn.classList.add('text-gray-400'); } else { newsPage.classList.remove('hidden'); predictionsPage.classList.add('hidden'); newsBtn.classList.add('bg-blue-600', 'text-white'); newsBtn.classList.remove('text-gray-400'); predictionsBtn.classList.remove('bg-blue-600', 'text-white'); predictionsBtn.classList.add('text-gray-400'); } 
        }
        predictionsBtn.addEventListener('click', () => switchPage('predictions'));
        newsBtn.addEventListener('click', () => switchPage('news'));
        initializePredictionsPage();
        initializeNewsPage();
    });

    // ======================================================================
    // SECTION 1: PREDICTIONS PAGE LOGIC (Supabase Predictions & Comments)
    // ======================================================================
    async function initializePredictionsPage() {
        const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';
        try {
            const container = document.getElementById('matches-container');
            container.innerHTML = '<p class="text-center text-gray-400 mt-8"><i class="fa-solid fa-spinner fa-spin mr-2"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</p>';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            let { data: matchesDataFromDB, error } = await supabaseClient.from('matches').select('*').order('datetime', { ascending: true });
            if (error) { throw error; }
            const formattedMatches = matchesDataFromDB.map(match => ({ id: match.id, team1: { name: match.team1_name, logo: match.team1_logo }, team2: { name: match.team2_name, logo: match.team2_logo }, league: match.league, datetime: match.datetime, channels: match.channels || [] }));
            document.getElementById('matches-container').innerHTML = `<div class="date-tabs-container" id="date-tabs"></div><div id="days-content-container"></div>`;
            initializeAppWithData(formattedMatches);
        } catch (error) {
            console.error("An error occurred:", error);
            const container = document.getElementById('matches-container');
            if (container) { container.innerHTML = '<p class="text-center text-red-500 mt-8">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>'; }
        }
    }

    function initializeAppWithData(matchesData) {
        const tickerMessages = ["ğŸ† Ø³ÙŠØªÙ… ØªÙƒØ±ÙŠÙ… Ø£ÙØ¶Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ÙŠÙ† ÙÙŠ Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹!", "ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø³Ø­Ø¨.", "ğŸ”¥ ØªØ§Ø¨Ø¹ÙˆÙ†Ø§ ÙÙŠ ØªØºØ·ÙŠØ© Ø®Ø§ØµØ© Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… Ù„Ù„Ø£Ù†Ø¯ÙŠØ©."];
        const dateTabsContainer = document.getElementById('date-tabs');
        const daysContentContainer = document.getElementById('days-content-container');
        function getMatchStatus(d) { const m = new Date(d); const n = new Date(); const f = (m.getTime() - n.getTime()) / 60000; if (f < -125) return { state: 'ended' }; if (f <= 0) return { state: 'live' }; if (f <= 5) return { state: 'soon' }; return { state: 'scheduled' }; }
        function renderMatchesForDay(d, m) { d.innerHTML = ''; if (!m || m.length === 0) return; const n = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9'}; m.forEach(t => { const a = new Date(t.datetime); const e = a.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' }).replace(/[Ù -Ù©]/g, c => n[c]); const i = a.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true }).replace(/[Ù -Ù©]/g, c => n[c]); const s = getMatchStatus(t.datetime); let o; switch (s.state) { case 'ended': o = `<span class="match-status ended">Ø§Ù†ØªÙ‡Øª</span>`; break; case 'live': o = `<span class="match-status live">Ù…Ø¨Ø§Ø´Ø±</span>`; break; case 'soon': o = `<span class="match-status soon">Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„</span>`; break; default: o = `<div class="match-time">${i}</div>`; } const l = (t.channels && t.channels.length > 0) ? t.channels.join(' / ') : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©"; const r = s.state === 'ended'; const u = document.createElement('div'); u.className = 'match-card'; u.dataset.matchId = t.id; u.innerHTML = `<div class="match-header"><span class="match-league">${t.league}</span><span class="match-date-time">${e}</span></div><div class="match-body"><div class="teams-row"><div class="team"><img src="${t.team1.logo}" alt="${t.team1.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${t.team1.name}</span></div><div class="match-status-container">${o}</div><div class="team"><img src="${t.team2.logo}" alt="${t.team2.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${t.team2.name}</span></div></div><form name="prediction-form" class="prediction-form ${r ? 'disabled' : ''}"><div class="form-group"><legend class="channel-info"><i class="fa-solid fa-tv"></i> <span>${l}</span></legend></div><div class="form-group"><legend>ØªÙˆÙ‚Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©:</legend><div class="prediction-options"><input type="radio" name="winner" id="win1-${t.id}" value="${t.team1.name}" required><label for="win1-${t.id}">${t.team1.name}</label><input type="radio" name="winner" id="draw-${t.id}" value="ØªØ¹Ø§Ø¯Ù„"><label for="draw-${t.id}">ØªØ¹Ø§Ø¯Ù„</label><input type="radio" name="winner" id="win2-${t.id}" value="${t.team2.name}"><label for="win2-${t.id}">${t.team2.name}</label></div></div><div class="form-group"><legend>Ù…Ù† Ø³ÙŠØ³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</legend><input type="text" name="scorer" class="scorer-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨..."></div><div class="form-group"><button type="submit" class="submit-btn">${r ? 'Ø£ØºÙ„Ù‚Øª Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙ‚Ø¹'}</button></div></form></div><div class="match-footer"><button class="toggle-comments-btn" ${r ? 'disabled' : ''}>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button><div class="comments-section" style="display:none;"><div class="comment-list"></div><form name="match-comment-form" class="comment-form"><textarea name="comment_text" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ..." required></textarea><button type="submit">Ø¥Ø±Ø³Ø§Ù„</button></form></div></div>`; d.appendChild(u); }); }
        function attachTabEventListeners() { const d = document.getElementById('date-tabs'); d.addEventListener('click', (e) => { if (!e.target.classList.contains('date-tab')) return; const t = e.target.dataset.tabId; document.querySelectorAll('.date-tab').forEach(c => c.classList.remove('active')); e.target.classList.add('active'); document.querySelectorAll('.day-content').forEach(c => c.classList.remove('active')); document.getElementById(`day-${t}`).classList.add('active'); }); }
        function attachMatchEventListeners() { const d = document.getElementById('days-content-container'); const u = document.getElementById('user-icon-btn'); const i = document.getElementById('dismiss-icon-btn'); const c = document.getElementById('close-modal-btn'); const m = document.getElementById('user-modal'); const f = document.getElementById('user-info-form'); u.addEventListener('click', openUserModal); i.addEventListener('click', dismissFloatingIcon); c.addEventListener('click', closeUserModal); m.addEventListener('click', (e) => { if (e.target === m) closeUserModal(); }); f.addEventListener('submit', saveUserInfo); d.addEventListener('submit', e => { e.preventDefault(); if (e.target.name === 'prediction-form' || e.target.name === 'match-comment-form') { handleFormSubmit(e.target); } }); d.addEventListener('click', e => { if (e.target.classList.contains('toggle-comments-btn')) handleToggleComments(e.target); }); }
        function openUserModal() { document.getElementById('user-modal').classList.add('show'); }
        function closeUserModal() { document.getElementById('user-modal').classList.remove('show'); }
        function dismissFloatingIcon() { document.getElementById('floating-icon-container').classList.add('hidden'); sessionStorage.setItem('isIconDismissed', 'true'); }
        function saveUserInfo(e) { e.preventDefault(); const m = document.getElementById('user-modal'); const s = document.getElementById('save-status'); const u = { username: m.querySelector('#username').value.trim(), social: m.querySelector('#social_account').value.trim() }; if (!u.username) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….'); return; } localStorage.setItem('userInfo', JSON.stringify(u)); s.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…'; setTimeout(() => { s.textContent = ''; closeUserModal(); }, 1500); }
        function loadUserInfo() { const u = JSON.parse(localStorage.getItem('userInfo')); if (u) { document.getElementById('username').value = u.username || ''; document.getElementById('social_account').value = u.social || ''; } }
        function populateTicker() { const t = document.getElementById('predictions-ticker-content'); t.innerHTML = tickerMessages.map(m => `<span class="ticker-item">${m}</span>`).join(''); }
        
        async function handleFormSubmit(form) {
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
            submitBtn.disabled = true;
            const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
            if (!userInfo.username) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                openUserModal();
                return;
            }
            
            const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            if (form.name === 'prediction-form') {
                const matchCard = form.closest('.match-card');
                const matchId = matchCard.dataset.matchId;
                const winnerRadio = form.querySelector('input[name="winner"]:checked');
                if (!winnerRadio) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©.'); submitBtn.innerHTML = originalText; submitBtn.disabled = false; return; }
                const predictionData = { match_id: matchId, username: userInfo.username, social_account: userInfo.social, predicted_winner: winnerRadio.value, predicted_scorer: form.querySelector('input[name="scorer"]').value.trim() };
                try {
                    const { error } = await supabaseClient.from('predictions').insert([predictionData]);
                    if (error) throw error;
                    submitBtn.innerHTML = `ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…`;
                    [...form.elements].forEach(el => el.disabled = true);
                    localStorage.setItem(`prediction-${matchId}`, JSON.stringify({ winner: predictionData.predicted_winner, scorer: predictionData.predicted_scorer }));
                } catch (error) {
                    console.error('Error submitting prediction:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ ØªÙˆÙ‚Ø¹Ùƒ. Ù‚Ø¯ ØªÙƒÙˆÙ† ØªÙˆÙ‚Ø¹Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù…Ù† Ù‚Ø¨Ù„.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
                return;
            }
            
            if (form.name === 'match-comment-form') {
                const matchCard = form.closest('.match-card');
                const matchId = matchCard.dataset.matchId;
                const commentText = form.querySelector('textarea').value;
                try {
                    if (!commentText.trim()) { throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚ ÙØ§Ø±Øº."); }
                    const { error } = await supabaseClient.from('comments').insert([{ match_id: matchId, author: userInfo.username, comment_text: commentText }]);
                    if (error) throw error;
                    const commentList = form.closest('.comments-section').querySelector('.comment-list');
                    if (commentList.querySelector('p')) { commentList.innerHTML = ''; }
                    addCommentToDOM(commentList, { author: userInfo.username, text: commentText });
                    form.querySelector('textarea').value = '';
                } catch (error) { console.error('Error submitting comment:', error); alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ.');
                } finally { submitBtn.innerHTML = "Ø¥Ø±Ø³Ø§Ù„"; submitBtn.disabled = false; }
            }
        }
        
        async function handleToggleComments(b) { const s = b.nextElementSibling; const h = s.style.display === 'none' || !s.style.display; const l = s.querySelector('.comment-list'); const m = b.closest('.match-card'); const i = m.dataset.matchId; if (h) { s.style.display = 'block'; b.innerHTML = 'ğŸ’¬ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª'; l.innerHTML = '<p class="text-center text-gray-500 my-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...</p>'; const u = 'https://uxtxavurcgdeueeemmdi.supabase.co'; const a = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk'; const c = supabase.createClient(u, a); try { let { data: o, error: e } = await c.from('comments').select('author, comment_text, created_at').eq('match_id', i).order('created_at', { ascending: true }); if (e) throw e; l.innerHTML = ''; if (o.length === 0) { l.innerHTML = '<p class="text-center text-gray-500 my-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</p>'; } else { o.forEach(t => { addCommentToDOM(l, { author: t.author, text: t.comment_text }); }); } } catch (e) { console.error("Error fetching comments:", e); l.innerHTML = '<p class="text-center text-red-500 my-2">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª.</p>'; } } else { s.style.display = 'none'; b.innerHTML = 'ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª'; } }
        function addCommentToDOM(l, d) { const c = document.createElement('div'); c.className = 'comment'; c.innerHTML = `<div class="comment-avatar"><i class="fa-solid fa-user"></i></div><div class="comment-body"><span class="comment-author">${d.author}</span><p class="comment-text">${d.text}</p></div>`; l.appendChild(c); l.scrollTop = l.scrollHeight; }
        function loadFromStorage() { document.querySelectorAll('.match-card').forEach(c => { const i = c.dataset.matchId; const p = localStorage.getItem(`prediction-${i}`); if (p) { const d = JSON.parse(p); const f = c.querySelector('.prediction-form'); const w = f.querySelector(`input[value="${d.winner}"]`); if (w) w.checked = true; f.querySelector('.scorer-input').value = d.scorer; [...f.elements].forEach(el => el.disabled = true); f.querySelector('.submit-btn').innerHTML = 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…'; } }); }
        
        loadUserInfo();
        populateTicker();
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const upcomingMatchesData = matchesData.filter(m => new Date(new Date(m.datetime).toLocaleDateString('fr-CA')) >= today);
        const matchesByDay = upcomingMatchesData.reduce((acc, m) => { const d = new Date(m.datetime).toLocaleDateString('fr-CA'); if (!acc[d]) acc[d] = []; acc[d].push(m); return acc; }, {});
        if (Object.keys(matchesByDay).length === 0) { daysContentContainer.innerHTML = `<p class="text-center text-gray-400 mt-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù‚Ø§Ø¯Ù…Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>`; } else { const s = Object.keys(matchesByDay).sort(); const n = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9'}; s.forEach((d, i) => { const a = new Date(d + 'T00:00:00Z'); const t = a.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' }).replace(/[Ù -Ù©]/g, c => n[c]); const b = document.createElement('div'); b.className = `date-tab ${i === 0 ? 'active' : ''}`; b.textContent = t; b.dataset.tabId = d; dateTabsContainer.appendChild(b); const e = document.createElement('div'); e.className = `day-content ${i === 0 ? 'active' : ''}`; e.id = `day-${d}`; daysContentContainer.appendChild(e); const o = { 'live': 1, 'soon': 2, 'scheduled': 3, 'ended': 4 }; const r = matchesByDay[d].sort((x, y) => { const sA = getMatchStatus(x.datetime).state; const sB = getMatchStatus(y.datetime).state; if (o[sA] !== o[sB]) return o[sA] - o[sB]; return new Date(x.datetime) - new Date(y.datetime); }); renderMatchesForDay(e, r); }); }
        attachTabEventListeners();
        attachMatchEventListeners();
        loadFromStorage();
    }

    // ==========================================================
    // SECTION 2: NEWS PAGE LOGIC (WITH SUPABASE COMMENTS)
    // ==========================================================
    function initializeNewsPage() {
        const ADMIN_PASSWORD = '1122';
        let articlesData = [ { "id": 6, "title": "Ù…Ø¨Ø§Ø¨ÙŠ ÙŠØ¹ÙˆØ¯.. ÙˆØ§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£ÙˆÙ„ ÙŠÙ‚ØªØ±Ø¨!", "image": "https://a.top4top.io/p_3463f03ts0.jpg", "publishDate": "2025-06-25", "badge": "hot", "fullText": "<p>Ø¹Ø§Ø¯ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„ÙØ±Ù†Ø³ÙŠ ÙƒÙŠÙ„ÙŠØ§Ù† Ù…Ø¨Ø§Ø¨ÙŠ Ø¥Ù„Ù‰ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ù…Ø¹ Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯ Ø¨Ø¹Ø¯ ØªØ¹Ø§ÙÙŠÙ‡ Ù…Ù† Ø§Ù„ÙˆØ¹ÙƒØ© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø¨Ø¹Ø¯ØªÙ‡ Ø¹Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ø®Ù„Ø§Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.</p><p>Ø§Ù„Ù…Ù‡Ø§Ø¬Ù… Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¸Ù‡Ø± ÙÙŠ Ø£Ø¬ÙˆØ§Ø¡ Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ø­Ù…Ø§Ø³ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ²ØŒ Ø¶Ù…Ù† Ø§Ø³ØªØ¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… Ù„Ù„Ø£Ù†Ø¯ÙŠØ©ØŒ Ø­ÙŠØ« ÙŠØªØ·Ù„Ù‘Ø¹ Ù„Ø¸Ù‡ÙˆØ±Ù‡ Ø§Ù„Ø£ÙˆÙ„ Ø¨Ù‚Ù…ÙŠØµ Ø§Ù„Ù…ÙŠØ±ÙŠÙ†ØºÙŠ.</p><p>Ø§Ù„Ù…Ø¯Ø±Ø¨ ØªØ´Ø§Ø¨ÙŠ Ø£Ù„ÙˆÙ†Ø³Ùˆ Ø¨Ø¯Ø§ Ø­Ø°Ø±Ù‹Ø§ ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…Ø¨Ø§Ø¨ÙŠØŒ Ù„ÙƒÙ†Ù‡ Ø£Ø´Ø§Ø± Ø¥Ù„Ù‰ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù‡ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©ØŒ Ù…Ø¤ÙƒØ¯Ù‹Ø§ Ø£Ù†Ù‡ Ø³ÙŠÙƒÙˆÙ† Ø¹Ù†ØµØ±Ù‹Ø§ Ø­Ø§Ø³Ù…Ù‹Ø§ ÙÙŠ Ù…Ø´ÙˆØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚.</p><p>Ø¬Ù…Ø§Ù‡ÙŠØ± Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯ ØªØªØ±Ù‚Ù‘Ø¨ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„ØªÙŠ Ø³ÙŠØ±ØªØ¯ÙŠ ÙÙŠÙ‡Ø§ Ù…Ø¨Ø§Ø¨ÙŠ Ø§Ù„Ù‚Ù…ÙŠØµ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø±Ø³Ù…ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ø¹Ø¨ØŒ Ø®Ø§ØµØ© ÙˆØ£Ù† Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ù…Ø¹Ù‡ ÙƒØ§Ù† Ø§Ù„Ø­Ù„Ù… Ø§Ù„Ø£ÙƒØ¨Ø± Ù„Ù„Ù…Ø¯Ø±ÙŠØ¯ÙŠÙŠÙ† Ù…Ù†Ø° Ø³Ù†ÙˆØ§Øª.</p><p>ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ø§Ø± ØªØªØ¬Ù‡ Ø§Ù„Ø¢Ù† Ù†Ø­Ùˆ Ø£ÙˆÙ„ Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ù„ÙØ±ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©ØŒ ÙÙ‡Ù„ ÙŠØ¨Ø¯Ø£ ØªØ´Ø§Ø¨ÙŠ Ø¨Ù…ÙØ§Ø¬Ø£Ø© ÙˆÙŠÙØ´Ø±Ùƒ Ù…Ø¨Ø§Ø¨ÙŠ Ù…Ù†Ø° Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŸ</p>" }, { "id": 5, "title": "Ø¥Ø³ØªÙŠÙØ§Ùˆ ÙˆÙŠÙ„ÙŠØ§Ù†.. Ø£ÙƒØ«Ø± Ù„Ø§Ø¹Ø¨ Ù…Ø­Ø¸ÙˆØ¸ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…!", "image": "https://f.top4top.io/p_3462yrvqf0.jpg", "publishDate": "2025-06-24", "badge": "hot", "fullText": "<p>ÙÙŠ Ù…Ø¨Ø§Ø±Ø§Ø© ÙˆØ¯Ù‘ÙŠØ© Ø¬Ù…Ø¹Øª Ø¨Ø§Ù„Ù…ÙŠØ±Ø§Ø³ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ ÙˆØ¥Ù†ØªØ± Ù…ÙŠØ§Ù…ÙŠ Ø§Ù„Ø£Ù…ÙŠØ±ÙƒÙŠØŒ Ø®Ø·Ù Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ø´Ø§Ø¨ Ø¥Ø³ØªÙŠÙØ§Ùˆ ÙˆÙŠÙ„ÙŠØ§Ù† Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡ Ø¨Ù„Ù‚Ø·Ø© Ù„Ù† ÙŠÙ†Ø³Ø§Ù‡Ø§ Ø·ÙŠÙ„Ø© Ù…Ø³ÙŠØ±ØªÙ‡.</p><p>ÙˆÙŠÙ„ÙŠØ§Ù†ØŒ Ø§Ù„Ø°ÙŠ Ù„Ù… ÙŠØªØ¬Ø§ÙˆØ² 17 Ø¹Ø§Ù…Ù‹Ø§ Ø¨Ø¹Ø¯ØŒ Ø§Ø³ØªØºÙ„ ÙØ±ØµØ© Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø£Ù…Ø§Ù… Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„ÙŠÙ‚ÙˆÙ… Ø¨ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù‚Ù…ØµØ§Ù† Ù…Ø¹ Ù„ÙŠÙˆÙ†ÙŠÙ„ Ù…ÙŠØ³ÙŠ Ø¨ÙŠÙ† Ø´ÙˆØ·ÙŠ Ø§Ù„Ù„Ù‚Ø§Ø¡ØŒ ÙˆØ³Ø· Ø¯Ù‡Ø´Ø© Ø§Ù„Ø¬Ù…Ø§Ù‡ÙŠØ±.</p><p>Ù„ÙƒÙ† Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© Ø§Ù„Ø£ÙƒØ¨Ø± ÙƒØ§Ù†Øª Ø¹Ù‚Ø¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŒ Ø¹Ù†Ø¯Ù…Ø§ ØªÙˆØ¬Ù‘Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ù„ÙˆÙŠØ³ Ø³ÙˆØ§Ø±ÙŠØ² ÙˆØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ù‚Ù…ÙŠØµ Ù…Ø¹Ù‡ Ø£ÙŠØ¶Ù‹Ø§ØŒ Ù„ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ù‚Ù…ÙŠØµÙŠ Ø§Ø«Ù†ÙŠÙ† Ù…Ù† Ø£Ø¹Ø¸Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ ØªØ§Ø±ÙŠØ® ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù….</p><p>Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ø§Ù†ØªØ´Ø±Øª ÙƒØ§Ù„Ù†Ø§Ø± ÙÙŠ Ø§Ù„Ù‡Ø´ÙŠÙ… Ø¹Ø¨Ø± Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙˆØ§ØµÙ„ØŒ ÙˆØ§Ø¹ØªØ¨Ø±Ù‡Ø§ ÙƒØ«ÙŠØ±ÙˆÙ† Ø¯Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø£Ù† Ø§Ù„Ù†Ø¬Ù… Ø§Ù„ØµØ§Ø¹Ø¯ ÙŠØ¹ÙŠØ´ Ø­Ù„Ù…Ù‹Ø§ Ù„Ø§ ÙŠØ¹ÙŠØ´Ù‡ Ø³ÙˆÙ‰ Ø§Ù„Ù‚Ù„Ø§Ø¦Ù„.</p><p>Ø§Ù„ØµØ­Ø§ÙØ© Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠØ© ÙˆØµÙØª Ø§Ù„Ø£Ù…Ø± Ø¨Ø£Ù†Ù‡ \"Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£Ø­Ù„Ø§Ù…\" Ù„Ø¥Ø³ØªÙŠÙØ§ÙˆØŒ ÙÙŠÙ…Ø§ Ø¨Ø¯Ø£ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙˆÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†: Ù‡Ù„ Ù‡Ùˆ Ù…Ø¬Ø±Ø¯ Ù…Ø­Ø¸ÙˆØ¸ØŸ Ø£Ù… Ù†Ø¬Ù… Ù‚Ø§Ø¯Ù… Ø¨Ù‚ÙˆØ©ØŸ</p>" }, { "id": 4, "title": "Ø³Ø§Ù† Ø¬ÙŠØ±Ù…Ø§Ù† ÙŠØªØµØ¯Ø±.. ÙˆØ£ØªÙ„ØªÙŠÙƒÙˆ Ù…Ø¯Ø±ÙŠØ¯ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙˆÙ†Ø¯ÙŠØ§Ù„!", "image": "https://e.top4top.io/p_3461all000.jpg", "publishDate": "2025-06-23", "badge": "hot", "fullText": "<p>Ø§Ù†ØªÙ‡Øª Ù…Ù†Ø§ÙØ³Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙÙŠ ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… Ù„Ù„Ø£Ù†Ø¯ÙŠØ© Ø¨Ù†ØªØ§Ø¦Ø¬ Ù…Ø«ÙŠØ±Ø© ÙˆÙ…ÙØ§Ø¬Ø¢Øª Ù…Ø¯ÙˆÙŠØ©ØŒ Ø£Ø¨Ø±Ø²Ù‡Ø§ Ø®Ø±ÙˆØ¬ Ø£ØªÙ„ØªÙŠÙƒÙˆ Ù…Ø¯Ø±ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£ÙˆÙ„ Ø±ØºÙ… Ø§Ù…ØªÙ„Ø§ÙƒÙ‡ Ù†ÙØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· ÙƒØ§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†.</p><p>Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ù…ØºØ±Ø¨ÙŠ Ø£Ø´Ø±Ù Ø­ÙƒÙŠÙ…ÙŠ Ù‚Ø§Ø¯ ÙØ±ÙŠÙ‚Ù‡ Ø¨Ø§Ø±ÙŠØ³ Ø³Ø§Ù† Ø¬ÙŠØ±Ù…Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„ÙÙˆØ² Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ø°ÙŠ Ø¶Ù…Ù† Ø§Ù„ØµØ¯Ø§Ø±Ø© Ø¨ÙØ§Ø±Ù‚ Ø§Ù„Ø£Ù‡Ø¯Ø§ÙØŒ Ø¨Ø¹Ø¯ Ø£Ø¯Ø§Ø¡ Ù‚ÙˆÙŠ ÙˆØªØ£Ù„Ù‚ ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„Ø¬Ø¨Ù‡Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰.</p><p>ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ØŒ ØªØ£Ù‡Ù„ Ø¨ÙˆØªØ§ÙÙˆØ¬Ùˆ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ù€16 Ø±ØºÙ… Ø§Ù„Ø®Ø³Ø§Ø±Ø©ØŒ Ù…Ø³ØªÙÙŠØ¯Ù‹Ø§ Ù…Ù† ØªÙÙˆÙ‚Ù‡ Ø¹Ù„Ù‰ Ø£ØªÙ„ØªÙŠÙƒÙˆ Ù…Ø¯Ø±ÙŠØ¯ Ø¨ÙØ§Ø±Ù‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØŒ ÙÙŠ ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø£ÙƒØ«Ø± Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø¥Ø«Ø§Ø±Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ³Ù….</p><p>Ø£Ù…Ø§ Ø£ØªÙ„ØªÙŠÙƒÙˆØŒ ÙÙ‚Ø¯ Ø¯ÙØ¹ Ø«Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¶Ø¹ÙŠÙØ©ØŒ Ø­ÙŠØ« Ù„Ù… ÙŠØ´ÙØ¹ Ù„Ù‡ Ø§Ù„ÙÙˆØ² Ø§Ù„Ø£Ø®ÙŠØ± Ø¨Ø³Ø¨Ø¨ ÙØ§Ø±Ù‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø³Ù„Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ø¨Ù‚Ø§Ù‡ ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø« Ø¨Ø±ØµÙŠØ¯ 6 Ù†Ù‚Ø§Ø·.</p><p>Ø³ÙŠØ§ØªÙ„ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ ÙƒØ§Ù† Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø£Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ø­ÙŠØ« ÙˆØ¯Ù‘Ø¹ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ø¯ÙˆÙ† Ø£ÙŠ Ù†Ù‚Ø·Ø© Ø¨Ø¹Ø¯ Ø«Ù„Ø§Ø« Ù‡Ø²Ø§Ø¦Ù… Ù…ØªØªØ§Ù„ÙŠØ© ÙˆÙØ§Ø±Ù‚ Ø£Ù‡Ø¯Ø§Ù ÙƒØ¨ÙŠØ± Ø¨Ù„Øº -5.</p>" }, ];
        const newsHomePage = document.querySelector('#news-page #home-page'); const newsArticlePage = document.querySelector('#news-page #article-page'); const articlesGrid = document.querySelector('#news-page #articles-grid'); const articleContent = document.querySelector('#news-page #article-content'); const notificationToast = document.querySelector('#news-page #notification-toast'); const exitToast = document.getElementById('exit-toast'); let currentArticleId = null; let currentNewsSubPage = 'home'; let firstBackPressTime = 0;
        function showToast(m, t = 'success', d = 3000) { notificationToast.textContent = m; notificationToast.className = `show ${t}`; setTimeout(() => { notificationToast.classList.remove('show'); }, d); }
        function navigateToNewsSubPage(p) { currentNewsSubPage = p; if (p === 'article') { newsHomePage.style.transform = 'translateX(-100%)'; newsArticlePage.style.transform = 'translateX(0)'; } else { newsHomePage.style.transform = 'translateX(0)'; newsArticlePage.style.transform = 'translateX(100%)'; } }
        function showArticle(i) { const a = articlesData.find(d => d.id === i); if (!a) return; currentArticleId = a.id; if (typeof gtag !== 'undefined') { gtag('event', 'view_item', { 'item_name': a.title }); } articleContent.innerHTML = `<div id="article-header"><h1>${a.title}</h1><button id="share-button" title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø¨Ø±"><i class="fa-solid fa-share-nodes"></i></button></div><img src="${a.image}" alt="${a.title}">${a.fullText}`; document.getElementById('article-title-hidden-input').value = a.title; document.getElementById('share-button').addEventListener('click', () => { if (typeof gtag !== 'undefined') { gtag('event', 'share', { 'method': 'Native/Clipboard', 'content_type': 'article', 'item_id': a.title }); } const s = { title: a.title, text: `Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø¨Ø±: ${a.title}`, url: window.location.href }; if (navigator.share) { navigator.share(s).catch(console.error); } else { navigator.clipboard.writeText(`${s.text}\n${s.url}`).then(() => showToast('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø¨Ø±!')).catch(err => alert('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.')); } }); loadComments(currentArticleId); newsArticlePage.scrollTop = 0; navigateToNewsSubPage('article'); }
        function buildHomePage() { articlesGrid.innerHTML = ''; articlesData.forEach(a => { const c = document.createElement('div'); c.className = 'article-card'; c.innerHTML = `<img src="${a.image}" alt="${a.title}"><div class="article-title"><h3>${a.title}</h3></div>`; c.addEventListener('click', () => showArticle(a.id)); articlesGrid.appendChild(c); }); }
        async function loadComments(i) { const l = document.querySelector('#news-page #comments-list'); l.innerHTML = '<p style="color: var(--secondary-text-color); text-align: center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...</p>'; const u = 'https://uxtxavurcgdeueeemmdi.supabase.co'; const a = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk'; const c = supabase.createClient(u, a); try { const { data: o, error: e } = await c.from('news_comments').select('id, created_at, author, comment_text').eq('article_id', i).order('created_at', { ascending: true }); if (e) throw e; l.innerHTML = ''; if (o.length === 0) { l.innerHTML = '<p style="color: var(--secondary-text-color); text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</p>'; return; } const n = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9'}; o.forEach(t => { const d = document.createElement('div'); d.className = 'comment-item'; const s = document.createTextNode(t.author || 'Ù…Ø¬Ù‡ÙˆÙ„').textContent; const x = document.createTextNode(t.comment_text).textContent; const m = new Date(t.created_at).toLocaleString('ar-EG', { dateStyle: 'short', timeStyle: 'short' }).replace(/[Ù -Ù©]/g, f => n[f]); d.innerHTML = `<button class="delete-comment-btn" onclick="handleNewsDeleteComment(${t.id}, ${i})" title="Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚"><i class="fa-solid fa-trash"></i></button><div class="comment-header"><span class="comment-author">${s}</span><span class="comment-date">${m}</span></div><p class="comment-body">${x}</p>`; l.appendChild(d); }); } catch(e) { console.error("Error loading news comments:", e); l.innerHTML = '<p class="text-red-500 text-center">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>'; } }
        async function handleNewsCommentSubmit(e) { e.preventDefault(); const n = document.getElementById('comment-name'); const t = document.getElementById('comment-text'); const b = document.getElementById('submit-comment-btn'); const a = n.value.trim(); const c = t.value.trim(); if (!c) return; b.disabled = true; b.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...'; const u = 'https://uxtxavurcgdeueeemmdi.supabase.co'; const k = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk'; const s = supabase.createClient(u, k); try { const { error: r } = await s.from('news_comments').insert([{ article_id: currentArticleId, author: a || 'Ù…Ø¬Ù‡ÙˆÙ„', comment_text: c }]); if (r) throw r; showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ø¨Ù†Ø¬Ø§Ø­!'); loadComments(currentArticleId); } catch (r) { console.error("Failed to submit comment to Supabase:", r); showToast('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚.', 'error'); } finally { b.disabled = false; b.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚'; t.value = ''; } }
        window.handleNewsDeleteComment = async function(i, a) { const p = prompt("Ù„Ù„ØªØ­Ù‚Ù‚ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:"); if (p === ADMIN_PASSWORD) { const u = 'https://uxtxavurcgdeueeemmdi.supabase.co'; const k = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk'; const s = supabase.createClient(u, k); try { const { error: e } = await s.from('news_comments').delete().eq('id', i); if (e) throw e; loadComments(a); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­.'); } catch (e) { console.error("Failed to delete comment:", e); alert("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚."); } } else if (p !== null) { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!"); } }
        document.querySelector('#news-page #comment-form').addEventListener('submit', handleNewsCommentSubmit);
        let touchStartX = 0; let isSwiping = false; newsArticlePage.addEventListener('touchstart', e => { if (e.changedTouches[0].screenX < 50 || e.changedTouches[0].screenX > window.innerWidth - 50) { touchStartX = e.changedTouches[0].screenX; isSwiping = true; } }); newsArticlePage.addEventListener('touchend', e => { if (!isSwiping) return; isSwiping = false; const t = e.changedTouches[0].screenX; const d = Math.abs(t - touchStartX); if (d > 75) { navigateToNewsSubPage('home'); } });
        document.addEventListener('backbutton', (e) => { e.preventDefault(); const p = document.getElementById('news-page'); if (!p.classList.contains('hidden') && currentNewsSubPage === 'article') { navigateToNewsSubPage('home'); } else { if (new Date().getTime() - firstBackPressTime < 2000) { if (navigator.app && navigator.app.exitApp) { navigator.app.exitApp(); } } else { firstBackPressTime = new Date().getTime(); exitToast.classList.add('show'); setTimeout(() => { exitToast.classList.remove('show'); }, 2000); } } }, false);
        buildHomePage();
    }
</script>
</body>
</html>
