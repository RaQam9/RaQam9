        document.addEventListener('DOMContentLoaded', () => {
            // كل هذا الجزء يبقى كما هو
            const predictionsBtn = document.getElementById('nav-predictions-btn');
            const newsBtn = document.getElementById('nav-news-btn');
            const predictionsPage = document.getElementById('predictions-page');
            const newsPage = document.getElementById('news-page');
            function switchPage(pageToShow) { 
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'select_content', {
                        'content_type': 'tab',
                        'item_id': pageToShow
                    });
                }
                if (pageToShow === 'predictions') { predictionsPage.classList.remove('hidden'); newsPage.classList.add('hidden'); predictionsBtn.classList.add('bg-blue-600', 'text-white'); predictionsBtn.classList.remove('text-gray-400'); newsBtn.classList.remove('bg-blue-600', 'text-white'); newsBtn.classList.add('text-gray-400'); } else { newsPage.classList.remove('hidden'); predictionsPage.classList.add('hidden'); newsBtn.classList.add('bg-blue-600', 'text-white'); newsBtn.classList.remove('text-gray-400'); predictionsBtn.classList.remove('bg-blue-600', 'text-white'); predictionsBtn.classList.add('text-gray-400'); } 
            }
            predictionsBtn.addEventListener('click', () => switchPage('predictions'));
            newsBtn.addEventListener('click', () => switchPage('news'));
            
            // تهيئة الصفحات
            initializePredictionsPage();
            initializeNewsPage();
        });

        // ======================================================================
        // SECTION 1: PREDICTIONS PAGE LOGIC (Supabase Version)
        // ======================================================================

        // --- إعدادات الاتصال العامة بـ Supabase ---
        const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


        async function initializePredictionsPage() {
            try {
                const container = document.getElementById('matches-container');
                container.innerHTML = '<p class="text-center text-gray-400 mt-8"><i class="fa-solid fa-spinner fa-spin mr-2"></i> جاري تحميل المباريات...</p>';

                let { data: matchesDataFromDB, error } = await supabaseClient
                    .from('matches') 
                    .select('*')
                    .order('datetime', { ascending: true });

                if (error) throw error;
                
                const formattedMatches = matchesDataFromDB.map(match => ({
                    id: match.id,
                    team1: { name: match.team1_name, logo: match.team1_logo },
                    team2: { name: match.team2_name, logo: match.team2_logo },
                    league: match.league,
                    datetime: match.datetime,
                    channels: match.channels || []
                }));
                
                document.getElementById('matches-container').innerHTML = `
                    <div class="date-tabs-container" id="date-tabs"></div>
                    <div id="days-content-container"></div>
                `;

                initializeAppWithData(formattedMatches);

            } catch (error) {
                console.error("An error occurred while fetching matches:", error);
                const container = document.getElementById('matches-container');
                if (container) {
                    container.innerHTML = '<p class="text-center text-red-500 mt-8">فشل تحميل المباريات. يرجى المحاولة مرة أخرى لاحقًا.</p>';
                }
            }
        }

        function initializeAppWithData(matchesData) {
            const tickerMessages = ["🏆 سيتم تكريم أفضل المتوقعين في نهاية كل أسبوع!", "💡 تأكد من حفظ بياناتك للمشاركة في السحب.", "🔥 تابعونا في تغطية خاصة لمباريات كأس العالم للأندية."];
            
            const dateTabsContainer = document.getElementById('date-tabs');
            const daysContentContainer = document.getElementById('days-content-container');
            const tickerContent = document.getElementById('predictions-ticker-content');
            
            dateTabsContainer.innerHTML = '';
            daysContentContainer.innerHTML = '';

            function getMatchStatus(matchDateStr) { const matchDate = new Date(matchDateStr); const now = new Date(); const diffMinutes = (matchDate.getTime() - now.getTime()) / 60000; if (diffMinutes < -125) return { state: 'ended' }; if (diffMinutes <= 0) return { state: 'live' }; if (diffMinutes <= 5) return { state: 'soon' }; return { state: 'scheduled' }; }
            
            function renderMatchesForDay(dayContentContainer, matches) { 
                dayContentContainer.innerHTML = ''; 
                if (!matches || matches.length === 0) return;
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                matches.forEach(match => { 
                    const matchDate = new Date(match.datetime); 
                    const dateString = matchDate.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' }).replace(/[٠-٩]/g, d => numMap[d]);
                    const timeString = matchDate.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true }).replace(/[٠-٩]/g, d => numMap[d]);
                    const statusInfo = getMatchStatus(match.datetime); 
                    let statusDisplay; 
                    switch (statusInfo.state) { 
                        case 'ended': statusDisplay = `<span class="match-status ended">انتهت</span>`; break; 
                        case 'live': statusDisplay = `<span class="match-status live">مباشر</span>`; break; 
                        case 'soon': statusDisplay = `<span class="match-status soon">بعد قليل</span>`; break; 
                        default: statusDisplay = `<div class="match-time">${timeString}</div>`; 
                    } 
                    const channels = (match.channels && match.channels.length > 0) ? match.channels.join(' / ') : "غير محددة"; 
                    const isMatchOver = statusInfo.state === 'ended'; 
                    const card = document.createElement('div'); 
                    card.className = 'match-card'; 
                    card.dataset.matchId = match.id; 
                    const matchName = `${match.team1.name} vs ${match.team2.name}`;
                    card.innerHTML = `
                        <div class="match-header"><span class="match-league">${match.league}</span><span class="match-date-time">${dateString}</span></div>
                        <div class="match-body">
                            <div class="teams-row">
                                <div class="team"><img src="${match.team1.logo}" alt="${match.team1.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team1.name}</span></div>
                                <div class="match-status-container">${statusDisplay}</div>
                                <div class="team"><img src="${match.team2.logo}" alt="${match.team2.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team2.name}</span></div>
                            </div>
                            <form name="prediction-form" class="prediction-form ${isMatchOver ? 'disabled' : ''}">
                                <input type="hidden" name="match_name" value="${matchName}" />
                                <input type="hidden" name="league" value="${match.league}" />
                                <div class="form-group">
                                    <legend class="channel-info"><i class="fa-solid fa-tv"></i> <span>${channels}</span></legend>
                                </div>
                                <div class="form-group">
                                    <legend>توقع النتيجة:</legend>
                                    <div class="prediction-options">
                                        <input type="radio" name="winner" id="win1-${match.id}" value="${match.team1.name}" required><label for="win1-${match.id}">${match.team1.name}</label>
                                        <input type="radio" name="winner" id="draw-${match.id}" value="تعادل"><label for="draw-${match.id}">تعادل</label>
                                        <input type="radio" name="winner" id="win2-${match.id}" value="${match.team2.name}"><label for="win2-${match.id}">${match.team2.name}</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <legend>من سيسجل أولاً؟ (اختياري)</legend>
                                    <input type="text" name="scorer" class="scorer-input" placeholder="اكتب اسم اللاعب...">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="submit-btn">${isMatchOver ? 'أغلقت التوقعات' : 'إرسال التوقع'}</button>
                                </div>
                            </form>
                        </div>
                        <div class="match-footer">
                            <button class="toggle-comments-btn">💬 التعليقات</button>
                            <div class="comments-section" style="display:none;">
                                <div class="comment-list"></div>
                                <form name="match-comment-form" class="comment-form">
                                    <textarea name="comment_text" placeholder="أضف تعليقك..." required></textarea>
                                    <button type="submit">إرسال</button>
                                </form>
                            </div>
                        </div>
                    `; 
                    dayContentContainer.appendChild(card); 
                }); 
            }

            function attachTabEventListeners() { 
                const dateTabsContainer = document.getElementById('date-tabs');
                dateTabsContainer.addEventListener('click', (e) => { 
                    if (!e.target.classList.contains('date-tab')) return; 
                    const tabId = e.target.dataset.tabId; 
                    document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active')); 
                    e.target.classList.add('active'); 
                    document.querySelectorAll('.day-content').forEach(content => content.classList.remove('active')); 
                    document.getElementById(`day-${tabId}`).classList.add('active'); 
                }); 
            }
            
            function attachMatchEventListeners() { 
                const daysContentContainer = document.getElementById('days-content-container');
                const userIconBtn = document.getElementById('user-icon-btn'); 
                const dismissIconBtn = document.getElementById('dismiss-icon-btn'); 
                const closeModalBtn = document.getElementById('close-modal-btn'); 
                const userModal = document.getElementById('user-modal'); 
                const userInfoForm = document.getElementById('user-info-form'); 
                userIconBtn.addEventListener('click', openUserModal); 
                dismissIconBtn.addEventListener('click', dismissFloatingIcon); 
                closeModalBtn.addEventListener('click', closeUserModal); 
                userModal.addEventListener('click', (e) => { if (e.target === userModal) closeUserModal(); }); 
                userInfoForm.addEventListener('submit', saveUserInfo); 
                daysContentContainer.addEventListener('submit', e => { 
                    e.preventDefault();
                    if (e.target.classList.contains('prediction-form') || e.target.classList.contains('comment-form')) { 
                        handleFormSubmit(e.target); 
                    }
                }); 
                daysContentContainer.addEventListener('click', e => { 
                    if (e.target.classList.contains('toggle-comments-btn')) handleToggleComments(e.target); 
                }); 
            }

            function openUserModal() { document.getElementById('user-modal').classList.add('show'); }
            function closeUserModal() { document.getElementById('user-modal').classList.remove('show'); }
            function dismissFloatingIcon() { document.getElementById('floating-icon-container').classList.add('hidden'); sessionStorage.setItem('isIconDismissed', 'true'); }
            
            function saveUserInfo(e) { 
                e.preventDefault(); 
                const userModal = document.getElementById('user-modal'); 
                const saveStatus = document.getElementById('save-status'); 
                const userInfo = { username: userModal.querySelector('#username').value.trim(), social: userModal.querySelector('#social_account').value.trim() }; 
                if (!userInfo.username) { alert('الرجاء إدخال اسم المستخدم.'); return; } 
                localStorage.setItem('userInfo', JSON.stringify(userInfo)); 
                saveStatus.textContent = 'تم الحفظ ✅'; 
                setTimeout(() => { saveStatus.textContent = ''; closeUserModal(); }, 1500); 
            }
            
            function loadUserInfo() { const userInfo = JSON.parse(localStorage.getItem('userInfo')); if (userInfo) { document.getElementById('username').value = userInfo.username || ''; document.getElementById('social_account').value = userInfo.social || ''; } }
            
            function populateTicker() { 
                const tickerContent = document.getElementById('predictions-ticker-content');
                tickerContent.innerHTML = tickerMessages.map(msg => `<span class="ticker-item">${msg}</span>`).join(''); 
            }
            
            async function handleFormSubmit(form) {
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
                submitBtn.disabled = true;

                const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};

                if (form.name === 'prediction-form') {
                    const formData = new FormData(form);
                    formData.append('username', userInfo.username || 'مجهول');
                    formData.append('social_account', userInfo.social || 'لا يوجد');

                    fetch("/", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: new URLSearchParams(formData).toString(),
                    })
                    .then(() => {
                        submitBtn.innerHTML = `تم الإرسال ✅`;
                        [...form.elements].forEach(el => el.disabled = true);
                        const matchCard = form.closest('.match-card');
                        const prediction = { 
                            winner: form.querySelector('input[name="winner"]:checked').value,
                            scorer: form.querySelector('input[name="scorer"]').value.trim() 
                        };
                        localStorage.setItem(`prediction-${matchCard.dataset.matchId}`, JSON.stringify(prediction));
                    })
                    .catch((error) => {
                        alert('حدث خطأ. الرجاء المحاولة مرة أخرى.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    });
                    return;
                }

                if (form.name === 'match-comment-form') {
                    const matchCard = form.closest('.match-card');
                    const matchId = matchCard.dataset.matchId;
                    const commentText = form.querySelector('textarea').value;
                    const authorName = userInfo.username || 'مجهول';

                    try {
                        const { data, error } = await supabaseClient
                            .from('comments')
                            .insert([{ match_id: matchId, author: authorName, comment_text: commentText }]);

                        if (error) throw error;
                        
                        const commentList = form.closest('.comments-section').querySelector('.comment-list');
                        if (commentList.querySelector('p')) {
                            commentList.innerHTML = '';
                        }
                        addCommentToDOM(commentList, { author: authorName, text: commentText });
                        form.querySelector('textarea').value = '';

                    } catch (error) {
                        console.error('Error submitting comment:', error);
                        alert('حدث خطأ أثناء إرسال تعليقك.');
                    } finally {
                        submitBtn.innerHTML = "إرسال";
                        submitBtn.disabled = false;
                    }
                }
            }

            async function handleToggleComments(button) {
                const commentsSection = button.nextElementSibling;
                const isHidden = commentsSection.style.display === 'none' || !commentsSection.style.display;
                const commentList = commentsSection.querySelector('.comment-list');
                const matchCard = button.closest('.match-card');
                const matchId = matchCard.dataset.matchId;

                if (isHidden) {
                    commentsSection.style.display = 'block';
                    button.innerHTML = '💬 إخفاء التعليقات';
                    commentList.innerHTML = '<p class="text-center text-gray-500 my-2">جاري تحميل التعليقات...</p>';

                    try {
                        let { data: comments, error } = await supabaseClient
                            .from('comments')
                            .select('author, comment_text, created_at')
                            .eq('match_id', matchId)
                            .order('created_at', { ascending: false });

                        if (error) throw error;

                        commentList.innerHTML = ''; 

                        if (comments.length === 0) {
                            commentList.innerHTML = '<p class="text-center text-gray-500 my-2">لا توجد تعليقات. كن أول من يعلق!</p>';
                        } else {
                            comments.forEach(comment => {
                                addCommentToDOM(commentList, { author: comment.author, text: comment.comment_text });
                            });
                        }
                    } catch (error) {
                        console.error("Error fetching comments:", error);
                        commentList.innerHTML = '<p class="text-center text-red-500 my-2">فشل تحميل التعليقات.</p>';
                    }

                } else {
                    commentsSection.style.display = 'none';
                    button.innerHTML = '💬 التعليقات';
                }
            }
            
            function addCommentToDOM(commentList, commentData) { 
                const newComment = document.createElement('div'); 
                newComment.className = 'comment'; 
                newComment.innerHTML = `<div class="comment-avatar"><i class="fa-solid fa-user"></i></div><div class="comment-body"><span class="comment-author">${commentData.author}</span><p class="comment-text">${commentData.text}</p></div>`; 
                commentList.appendChild(newComment); 
            }
            
            // دالة معدلة لتحميل التوقعات فقط
            function loadPredictionsFromStorage() { 
                document.querySelectorAll('.match-card').forEach(card => { 
                    const matchId = card.dataset.matchId; 
                    const savedPrediction = localStorage.getItem(`prediction-${matchId}`); 
                    if (savedPrediction) { 
                        const prediction = JSON.parse(savedPrediction); 
                        const form = card.querySelector('.prediction-form'); 
                        const winnerInput = form.querySelector(`input[value="${prediction.winner}"]`); 
                        if (winnerInput) winnerInput.checked = true; 
                        form.querySelector('.scorer-input').value = prediction.scorer; 
                        [...form.elements].forEach(el => el.disabled = true); 
                        form.querySelector('.submit-btn').innerHTML = 'تم الإرسال ✅'; 
                    }
                }); 
            }
            
            loadUserInfo();
            populateTicker();
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingMatchesData = matchesData.filter(match => new Date(match.datetime) >= today);

            const matchesByDay = upcomingMatchesData.reduce((acc, match) => { 
                const dayKey = new Date(match.datetime).toLocaleDateString('fr-CA'); 
                if (!acc[dayKey]) acc[dayKey] = []; 
                acc[dayKey].push(match); 
                return acc; 
            }, {});
            
            if (Object.keys(matchesByDay).length === 0) {
                daysContentContainer.innerHTML = `<p class="text-center text-gray-400 mt-8">لا توجد مباريات قادمة. يرجى التحقق لاحقًا.</p>`;
            } else {
                const sortedDays = Object.keys(matchesByDay).sort();
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                
                sortedDays.forEach((day, index) => {
                    const dayDate = new Date(day + 'T00:00:00Z');
                    const tabTitle = dayDate.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' }).replace(/[٠-٩]/g, d => numMap[d]);
                    
                    const tabButton = document.createElement('div');
                    tabButton.className = `date-tab ${index === 0 ? 'active' : ''}`;
                    tabButton.textContent = tabTitle;
                    tabButton.dataset.tabId = day;
                    dateTabsContainer.appendChild(tabButton);

                    const dayContentDiv = document.createElement('div');
                    dayContentDiv.className = `day-content ${index === 0 ? 'active' : ''}`;
                    dayContentDiv.id = `day-${day}`;
                    daysContentContainer.appendChild(dayContentDiv);

                    const statusOrder = { 'live': 1, 'soon': 2, 'scheduled': 3, 'ended': 4 };
                    const sortedMatches = matchesByDay[day].sort((a, b) => {
                        const statusA = getMatchStatus(a.datetime).state;
                        const statusB = getMatchStatus(b.datetime).state;
                        if (statusOrder[statusA] !== statusOrder[statusB]) {
                            return statusOrder[statusA] - statusOrder[statusB];
                        }
                        return new Date(a.datetime) - new Date(b.datetime);
                    });

                    renderMatchesForDay(dayContentDiv, sortedMatches);
                });
            }
            
            attachTabEventListeners();
            attachMatchEventListeners();
            loadPredictionsFromStorage(); // استدعاء الدالة الجديدة
        }

        // ==========================================================
        // SECTION 2: NEWS PAGE LOGIC (STABLE VERSION)
        // ==========================================================
        function initializeNewsPage() {
            // ... (كل كود صفحة الأخبار يبقى كما هو بدون تغيير)
            const ADMIN_PASSWORD = '1122';  
            
            const getTodaysDateString = (offsetDays = 0) => {
                const today = new Date();
                today.setDate(today.getDate() - offsetDays);
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            };
            
            let articlesData = [
                { "id": 6, "title": "مبابي يعود.. والظهور الأول يقترب!", "image": "https://a.top4top.io/p_3463f03ts0.jpg", "publishDate": "2025-06-25", "badge": "hot", "fullText": "<p>عاد النجم الفرنسي كيليان مبابي إلى التدريبات الجماعية مع ريال مدريد بعد تعافيه من الوعكة الصحية التي أبعدته عن الفريق خلال الأيام الماضية.</p><p>المهاجم العائد ظهر في أجواء مليئة بالحماس والتركيز، ضمن استعدادات الفريق للمشاركة في كأس العالم للأندية، حيث يتطلّع لظهوره الأول بقميص الميرينغي.</p><p>المدرب تشابي ألونسو بدا حذرًا في التعامل مع مبابي، لكنه أشار إلى إمكانية الدفع به تدريجيًا في المباريات القادمة، مؤكدًا أنه سيكون عنصرًا حاسمًا في مشوار الفريق.</p><p>جماهير ريال مدريد تترقّب اللحظة التي سيرتدي فيها مبابي القميص الأبيض رسميًا داخل الملعب، خاصة وأن التعاقد معه كان الحلم الأكبر للمدريديين منذ سنوات.</p><p>كل الأنظار تتجه الآن نحو أول مباراة للفريق في البطولة، فهل يبدأ تشابي بمفاجأة ويُشرك مبابي منذ البداية؟</p>" },
                { "id": 5, "title": "إستيفاو ويليان.. أكثر لاعب محظوظ في العالم!", "image": "https://f.top4top.io/p_3462yrvqf0.jpg", "publishDate": "2025-06-24", "badge": "hot", "fullText": "<p>في مباراة ودّية جمعت بالميراس البرازيلي وإنتر ميامي الأميركي، خطف النجم الشاب إستيفاو ويليان الأضواء بلقطة لن ينساها طيلة مسيرته.</p><p>ويليان، الذي لم يتجاوز 17 عامًا بعد، استغل فرصة مشاركته أمام أساطير اللعبة ليقوم بتبادل القمصان مع ليونيل ميسي بين شوطي اللقاء، وسط دهشة الجماهير.</p><p>لكن المفاجأة الأكبر كانت عقب نهاية المباراة، عندما توجّه مباشرة إلى لويس سواريز وتبادل القميص معه أيضًا، ليجمع بين قميصي اثنين من أعظم اللاعبين في تاريخ كرة القدم.</p><p>هذه اللحظة الاستثنائية انتشرت كالنار في الهشيم عبر مواقع التواصل، واعتبرها كثيرون دليلاً على أن النجم الصاعد يعيش حلمًا لا يعيشه سوى القلائل.</p><p>الصحافة البرازيلية وصفت الأمر بأنه \"أسبوع الأحلام\" لإستيفاو، فيما بدأ المتابعون يتساءلون: هل هو مجرد محظوظ؟ أم نجم قادم بقوة؟</p>" },
                { "id": 4, "title": "سان جيرمان يتصدر.. وأتلتيكو مدريد خارج المونديال!", "image": "https://e.top4top.io/p_3461all000.jpg", "publishDate": "2025-06-23", "badge": "hot", "fullText": "<p>انتهت منافسات المجموعة الثانية في كأس العالم للأندية بنتائج مثيرة ومفاجآت مدوية، أبرزها خروج أتلتيكو مدريد من الدور الأول رغم امتلاكه نفس عدد النقاط كالمتصدرين.</p><p>النجم المغربي أشرف حكيمي قاد فريقه باريس سان جيرمان إلى الفوز الأخير الذي ضمن الصدارة بفارق الأهداف، بعد أداء قوي وتألق واضح في الجبهة اليمنى.</p><p>في المقابل، تأهل بوتافوجو البرازيلي إلى دور الـ16 رغم الخسارة، مستفيدًا من تفوقه على أتلتيكو مدريد بفارق الأهداف الإيجابي، في واحدة من أكثر السيناريوهات إثارة هذا الموسم.</p><p>أما أتلتيكو، فقد دفع ثمن البداية الضعيفة، حيث لم يشفع له الفوز الأخير بسبب فارق الأهداف السلبي الذي أبقاه في المركز الثالث برصيد 6 نقاط.</p><p>سياتل الأمريكي كان الحلقة الأضعف في المجموعة، حيث ودّع البطولة دون أي نقطة بعد ثلاث هزائم متتالية وفارق أهداف كبير بلغ -5.</p>" },
                { "id": 10, "title": "كابرال يرد: 'چيان لعِين' ليست عنصرية!", "image": "https://b.top4top.io/p_3461gr2b90.jpg", "publishDate": "2025-06-23", "badge": "hot", "fullText": "<p>في واحدة من أبرز لقطات كأس العالم للأندية، التقطت الكاميرات مواجهة نارية بين أنطونيو روديجر وجوستافو كابرال، بعد أن بدا أن الأول شعر بإهانة عنصرية وجهها له لاعب باتشوكا.</p><p>ردّ كابرال جاء سريعًا عبر تصريح مثير، قال فيه: 'الحكم أشار بالعنصرية، وأنا واصلت تكرار ما قلته لروديجر چيان لعِين، ولم يكن هناك أي عنصرية في ذلك، كما نقولها في الأرجنتين، إنها مجرد كلمة.'</p><p>العبارة التي استخدمها كابرال تُعد شائعة في الأرجنتين، وتُقال أحيانًا داخل الملاعب للتعبير عن التوتر أو الغضب، دون نية عنصرية، لكنها قد تحمل معانٍ مختلفة في ثقافات أخرى، ما تسبب في سوء الفهم.</p><p>الجماهير تفاعلت بقوة مع المشهد، بين من يرى أن على اللاعبين احترام اختلاف الخلفيات، ومن يدافع عن كابرال مؤكدين أنه لم يقصد الإساءة، خاصة وأن روديجر معروف بحساسيته تجاه قضايا العنصرية بعد تجارب مؤلمة سابقة.</p><p>الحادثة تفتح مجددًا ملف التواصل بين الثقافات في الملاعب الدولية، وتؤكد أن كرة القدم، رغم كونها عالمية، تحتاج إلى حساسية مضاعفة تجاه ما يُقال داخل المستطيل الأخضر.</p>" },
                { "id": 3, "title": "الهلال يقترب من حسم صفقة تيو هيرنانديز", "image": "https://j.top4top.io/p_3461lgsle0.jpg", "fullText": "<p>أكد الصحفي الموثوق فابريزيو رومانو أن نادي الهلال السعودي بات قريبًا للغاية من التوقيع مع النجم الفرنسي تيو هيرنانديز، الظهير الأيسر لنادي ميلان الإيطالي. المفاوضات دخلت مراحلها النهائية بعد أن وافق اللاعب على الشروط الشخصية.</p><p>الهلال أبدى جدية كبيرة في المفاوضات، حيث قدم عرضًا مغريًا لميلان يتجاوز 70 مليون يورو، وهو ما جعل النادي الإيطالي يدرس العرض بجدية، خاصة في ظل حاجته لتمويل صفقات أخرى. تيو هيرنانديز يُعد من أفضل اللاعبين في مركزه خلال السنوات الأخيرة، وساهم بشكل كبير في تتويج ميلان بلقب الدوري الإيطالي موسم 2021-2022. في حال إتمام الصفقة، سيُشكل تيو إضافة نوعية لدفاع وهجوم الهلال في الموسم المقبل الذي يشهد مشاركات عالمية.</p>" },
                { "id": 7, "title": "ديكو: نيكو ويليامز يرغب في برشلونة وسنسعى للتوقيع معه", "image": "https://c.top4top.io/p_3460d0wq31.jpg", "fullText": `<p>في تصريح أشعل حماس جماهير برشلونة، أكد ديكو، المدير الرياضي للنادي، أن النجم الإسباني نيكو ويليامز أبدى رغبة واضحة في ارتداء قميص البلوجرانا. وقال ديكو: "نيكو لاعب كبير، وكل الأندية الكبرى تريده. نحن نعلم أنه يفضل مشروعنا وسنحاول إيجاد صيغة مناسبة للتوقيع معه".</p><p>ويليامز، الذي يمتلك شرطًا جزائيًا في عقده مع أتلتيك بلباو يقدر بحوالي 58 مليون يورو، يُعتبر هدفًا رئيسيًا للمدرب هانزي فليك لتعزيز مركز الجناح الأيسر. الصفقة قد تعتمد على قدرة برشلونة على بيع بعض اللاعبين أولاً لتحقيق التوازن المالي المطلوب وفقًا لقواعد اللعب المالي النظيف في الليغا.</p>`},
                { "id": 2, "title": "الأساطير لا تموت.. راموس وسيلفا يتألقان", "image": "https://e.top4top.io/p_34592f0l51.jpg", "fullText": `<p>في زمن تُقاس فيه كرة القدم بالسرعة واللياقة البدنية، يواصل الثنائي الأسطوري سيرجيو راموس وتياجو سيلفا كتابة فصولٍ مدهشة في مسيرتهما. راموس، بعد عودته لإشبيلية، أثبت أنه لا يزال صخرة دفاعية يُعتمد عليها، بينما قاد سيلفا دفاع تشيلسي بخبرته الكبيرة.</p><p>كلاهما تجاوز الـ37 من العمر، لكنهما يقدمان أداءً يفوق العديد من اللاعبين الشبان، مما يطرح تساؤلاً حول سر استمراريتهما في أعلى المستويات. الانضباط، الشغف، والخبرة هي العوامل الرئيسية التي تجعل من هذين اللاعبين نموذجًا يُحتذى به في عالم كرة القدم.</p>`},
                { "id": 1, "title": "البرازيل تُعلن ترشحها لاستضافة كأس العالم للأندية 2029", "image": "https://h.top4top.io/p_3459a7zx00.jpg", "fullText": `<p>في إعلان رسمي لفت الأنظار، كشف الاتحاد البرازيلي لكرة القدم عن نيته الترشح لاستضافة النسخة الثانية من كأس العالم للأندية بصيغتها الجديدة عام 2029. ويأتي هذا الإعلان ليعكس الرغبة الكبيرة لدى البرازيل في استضافة الأحداث الرياضية الكبرى مجددًا.</p><p>يعتمد الملف البرازيلي على البنية التحتية القوية التي خلفتها استضافة كأس العالم 2014، بالإضافة إلى الشغف الجماهيري الكبير بكرة القدم. وتواجه البرازيل منافسة محتملة من ملفات أخرى قد تتقدم بها دول من أوروبا وآسيا، مما ينبئ بسباق مثير على نيل شرف التنظيم.</p>`},
                { "id": 4, "title": "مشاكل لامين يامال النسائية تتصدر العناوين!", "image": "https://f.top4top.io/p_3459o9rcs0.jpg", "fullText": `<p>تداولت وسائل الإعلام خلال الساعات الأخيرة تصريحات متبادلة بين نجم برشلونة الشاب لامين يامال و"كلوديا بافيل"، عارضة أزياء وممثلة معروفة، بعد مزاعم بعلاقة سابقة بين الطرفين. بدأت القصة عندما نشرت بافيل تلميحات حول علاقتها بلاعب كرة قدم شاب، وهو ما فسره المتابعون بأنه لامين يامال.</p><p>من جانبه، نفى يامال عبر وكيله أي علاقة له بالأمر، مؤكدًا أن تركيزه منصب بالكامل على مسيرته الكروية مع برشلونة والمنتخب الإسباني. هذه الأحداث تثير الجدل حول تأثير الشهرة المبكرة على اللاعبين الشبان وكيفية تعاملهم مع الضغوط الإعلامية والشخصية.</p>`},
                { "id": 5, "title": "أندية أمريكا الجنوبية تفرض هيمنتها في مونديال الأندية", "image": "https://f.top4top.io/p_3459firs50.jpg", "fullText": `<p>في أداء لافت، واصلت أندية أمريكا الجنوبية كتابة سطور التحدي في كأس العالم للأندية 2025، بعد أن خاضت تسع مباريات دون أن تتذوق طعم الهزيمة. أندية مثل فلامنغو، بالميراس، وريفر بليت قدمت مستويات فنية عالية وأظهرت قدرة كبيرة على مجاراة الأندية الأوروبية.</p><p>هذا الأداء يعكس التطور الكبير في مستوى الأندية في أمريكا الجنوبية، وقدرتها على الاحتفاظ بنجومها لفترات أطول. المحللون يرون أن هذه النسخة من البطولة قد تشهد بطلاً من خارج القارة الأوروبية لأول مرة منذ سنوات طويلة، مما يزيد من إثارة المنافسة.</p>`}
            ];

            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const tenDaysInMs = 10 * 24 * 60 * 60 * 1000;
            articlesData = articlesData.filter(article => {
                if (!article.publishDate) return true;
                const publishDate = new Date(article.publishDate);
                const timeDiff = today.getTime() - publishDate.getTime();
                return timeDiff <= tenDaysInMs;
            });

            const newsHomePage = document.querySelector('#news-page #home-page'); 
            const newsArticlePage = document.querySelector('#news-page #article-page'); 
            const articlesGrid = document.querySelector('#news-page #articles-grid'); 
            const articleContent = document.querySelector('#news-page #article-content'); 
            const notificationToast = document.querySelector('#news-page #notification-toast'); 
            const exitToast = document.getElementById('exit-toast'); 
            let currentArticleId = null; 
            let currentNewsSubPage = 'home';
            let firstBackPressTime = 0;

            function showToast(message, type = 'success', duration = 3000) { notificationToast.textContent = message; notificationToast.className = `show ${type}`; setTimeout(() => { notificationToast.classList.remove('show'); }, duration); }
            function navigateToNewsSubPage(pageName) { currentNewsSubPage = pageName; if (pageName === 'article') { newsHomePage.style.transform = 'translateX(-100%)'; newsArticlePage.style.transform = 'translateX(0)'; } else { newsHomePage.style.transform = 'translateX(0)'; newsArticlePage.style.transform = 'translateX(100%)'; } }
            
            function showArticle(articleId) {
                const article = articlesData.find(a => a.id === articleId);
                if (!article) return;
                currentArticleId = article.id;
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'view_item', { 'item_name': article.title });
                }

                articleContent.innerHTML = `
                    <div id="article-header">
                        <h1>${article.title}</h1>
                        <button id="share-button" title="مشاركة الخبر"><i class="fa-solid fa-share-nodes"></i></button>
                    </div>
                    <img src="${article.image}" alt="${article.title}">
                    ${article.fullText}
                `;
                document.getElementById('article-title-hidden-input').value = article.title;
                
                document.getElementById('share-button').addEventListener('click', () => {
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'share', { 'method': 'Native/Clipboard', 'content_type': 'article', 'item_id': article.title });
                    }
                    const shareData = { title: article.title, text: `شاهد هذا الخبر: ${article.title}`, url: window.location.href };
                    if (navigator.share) {
                        navigator.share(shareData).catch(console.error);
                    } else {
                        navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(() => showToast('تم نسخ رابط الخبر!')).catch(err => alert('فشل نسخ الرابط.'));
                    }
                });
                
                loadComments(currentArticleId); 
                newsArticlePage.scrollTop = 0; 
                navigateToNewsSubPage('article'); 
            }

            function buildHomePage() { articlesGrid.innerHTML = ''; articlesData.forEach(article => { const card = document.createElement('div'); card.className = 'article-card'; card.innerHTML = `<img src="${article.image}" alt="${article.title}"><div class="article-title"><h3>${article.title}</h3></div>`; card.addEventListener('click', () => showArticle(article.id)); articlesGrid.appendChild(card); }); }
            
            function loadComments(articleId) { 
                const commentsList = document.querySelector('#news-page #comments-list'); 
                const comments = JSON.parse(localStorage.getItem(`comments_${articleId}`)) || []; 
                commentsList.innerHTML = ''; 
                if (comments.length === 0) { commentsList.innerHTML = '<p style="color: var(--secondary-text-color); text-align: center;">لا توجد تعليقات. كن أول من يعلق!</p>'; return; } 
                const numMap = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
                comments.slice().reverse().forEach(comment => { 
                    const commentElement = document.createElement('div'); 
                    commentElement.className = 'comment-item'; 
                    const safeAuthor = document.createTextNode(comment.name || 'مجهول').textContent; 
                    const safeText = document.createTextNode(comment.text).textContent; 
                    const commentDate = new Date(comment.date).toLocaleString('ar-EG', { dateStyle: 'short', timeStyle: 'short' }).replace(/[٠-٩]/g, d => numMap[d]);
                    commentElement.innerHTML = `<button class="delete-comment-btn" onclick="handleNewsDeleteComment(${articleId}, '${comment.date}')" title="حذف التعليق"><i class="fa-solid fa-trash"></i></button><div class="comment-header"><span class="comment-author">${safeAuthor}</span><span class="comment-date">${commentDate}</span></div><p class="comment-body">${safeText}</p>`; 
                    commentsList.appendChild(commentElement); 
                }); 
            }

            function handleNewsCommentSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const nameInput = document.getElementById('comment-name');
                const textInput = document.getElementById('comment-text');
                const submitBtn = document.getElementById('submit-comment-btn');
                const name = nameInput.value.trim();
                const text = textInput.value.trim();
                if (!text) return;

                submitBtn.disabled = true;
                submitBtn.textContent = 'جارِ الإرسال...';
                
                const formData = new FormData(form);
                fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                })
                .then(() => {
                    const comments = JSON.parse(localStorage.getItem(`comments_${currentArticleId}`)) || [];
                    const newComment = { name: name || 'مجهول', text: text, date: new Date().toISOString() };
                    comments.push(newComment);
                    localStorage.setItem(`comments_${currentArticleId}`, JSON.stringify(comments));
                    loadComments(currentArticleId);
                    showToast('تم إرسال تعليقك بنجاح!');
                })
                .catch(error => {
                    showToast('فشل إرسال التعليق.', 'error');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'إرسال التعليق';
                    nameInput.value = '';
                    textInput.value = '';
                });
            }

            window.handleNewsDeleteComment = function(articleId, commentDate) { 
                const password = prompt("للتحقق، يرجى إدخال كلمة مرور المدير:"); 
                if (password === ADMIN_PASSWORD) { 
                    let comments = JSON.parse(localStorage.getItem(`comments_${articleId}`)) || []; 
                    comments = comments.filter(c => c.date !== commentDate); 
                    localStorage.setItem(`comments_${articleId}`, JSON.stringify(comments)); 
                    loadComments(articleId); 
                    showToast('تم حذف التعليق بنجاح.'); 
                } else if (password !== null) { 
                    alert("كلمة المرور غير صحيحة!"); 
                } 
            }
            
            document.querySelector('#news-page #comment-form').addEventListener('submit', handleNewsCommentSubmit);
            
            let touchStartX = 0; 
            let isSwiping = false;
            newsArticlePage.addEventListener('touchstart', e => {
                if (e.changedTouches[0].screenX < 50 || e.changedTouches[0].screenX > window.innerWidth - 50) {
                    touchStartX = e.changedTouches[0].screenX;
                    isSwiping = true;
                }
            });
            newsArticlePage.addEventListener('touchend', e => {
                if (!isSwiping) return;
                isSwiping = false;
                const touchEndX = e.changedTouches[0].screenX;
                const swipeDistance = Math.abs(touchEndX - touchStartX);
                if (swipeDistance > 75) {
                    navigateToNewsSubPage('home');
                }
            });

            document.addEventListener('backbutton', (e) => {
                e.preventDefault();
                const newsPage = document.getElementById('news-page');
                if (!newsPage.classList.contains('hidden') && currentNewsSubPage === 'article') {
                    navigateToNewsSubPage('home');
                } else {
                    if (new Date().getTime() - firstBackPressTime < 2000) {
                        if (navigator.app && navigator.app.exitApp) { navigator.app.exitApp(); }
                    } else {
                        firstBackPressTime = new Date().getTime();
                        exitToast.classList.add('show');
                        setTimeout(() => { exitToast.classList.remove('show'); }, 2000);
                    }
                }
            }, false);

            buildHomePage();
        }
    </script>
</body>
</html>
