<script>
    document.addEventListener('DOMContentLoaded', () => {
        const predictionsBtn = document.getElementById('nav-predictions-btn');
        const newsBtn = document.getElementById('nav-news-btn');
        const predictionsPage = document.getElementById('predictions-page');
        const newsPage = document.getElementById('news-page');
        function switchPage(pageToShow) { 
            if (typeof gtag !== 'undefined') {
                gtag('event', 'select_content', {
                    'content_type': 'tab',
                    'item_id': pageToShow
                });
            }
            if (pageToShow === 'predictions') { predictionsPage.classList.remove('hidden'); newsPage.classList.add('hidden'); predictionsBtn.classList.add('bg-blue-600', 'text-white'); predictionsBtn.classList.remove('text-gray-400'); newsBtn.classList.remove('bg-blue-600', 'text-white'); newsBtn.classList.add('text-gray-400'); } else { newsPage.classList.remove('hidden'); predictionsPage.classList.add('hidden'); newsBtn.classList.add('bg-blue-600', 'text-white'); newsBtn.classList.remove('text-gray-400'); predictionsBtn.classList.remove('bg-blue-600', 'text-white'); predictionsBtn.classList.add('text-gray-400'); } 
        }
        predictionsBtn.addEventListener('click', () => switchPage('predictions'));
        newsBtn.addEventListener('click', () => switchPage('news'));
        initializePredictionsPage();
        initializeNewsPage();
    });

    // ======================================================================
    // SECTION 1: PREDICTIONS PAGE LOGIC (DATABASE-POWERED)
    // ======================================================================
    
    // --- دوال مساعدة لقسم التوقعات ---

    function getMatchStatus(matchDateStr) { 
        const matchDate = new Date(matchDateStr); 
        const now = new Date(); 
        const diffMinutes = (matchDate.getTime() - now.getTime()) / 60000; 
        if (diffMinutes < -125) return { state: 'ended' }; 
        if (diffMinutes <= 0) return { state: 'live' }; 
        if (diffMinutes <= 5) return { state: 'soon' }; 
        return { state: 'scheduled' }; 
    }

    function renderMatchesForDay(dayContentContainer, matches) { 
        dayContentContainer.innerHTML = ''; 
        if (!matches || matches.length === 0) return; 
        matches.forEach(match => { 
            const matchDate = new Date(match.datetime); 
            const dateString = matchDate.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' }); 
            const timeString = matchDate.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true });
            const statusInfo = getMatchStatus(match.datetime); 
            let statusDisplay; 
            switch (statusInfo.state) { 
                case 'ended': statusDisplay = `<span class="match-status ended">انتهت</span>`; break; 
                case 'live': statusDisplay = `<span class="match-status live">مباشر</span>`; break; 
                case 'soon': statusDisplay = `<span class="match-status soon">بعد قليل</span>`; break; 
                default: statusDisplay = `<div class="match-time">${timeString}</div>`; 
            } 
            const channels = (match.channels && match.channels.length > 0) ? match.channels.join(' / ') : "غير محددة"; 
            const isMatchOver = statusInfo.state === 'ended'; 
            const card = document.createElement('div'); 
            card.className = 'match-card'; 
            card.dataset.matchId = match.id; 
            const matchName = `${match.team1.name} vs ${match.team2.name}`;
            card.innerHTML = `
                <div class="match-header"><span class="match-league">${match.league}</span><span class="match-date-time">${dateString}</span></div>
                <div class="match-body">
                    <div class="teams-row">
                        <div class="team"><img src="${match.team1.logo}" alt="${match.team1.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team1.name}</span></div>
                        <div class="match-status-container">${statusDisplay}</div>
                        <div class="team"><img src="${match.team2.logo}" alt="${match.team2.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/50';"><span class="team-name">${match.team2.name}</span></div>
                    </div>
                    <form name="prediction-form" class="prediction-form ${isMatchOver ? 'disabled' : ''}" data-netlify="true">
                        <input type="hidden" name="form-name" value="prediction-form" />
                        <input type="hidden" name="match_name" value="${matchName}" />
                        <input type="hidden" name="league" value="${match.league}" />
                        <div class="form-group">
                            <legend class="channel-info"><i class="fa-solid fa-tv"></i> <span>${channels}</span></legend>
                        </div>
                        <div class="form-group">
                            <legend>توقع النتيجة:</legend>
                            <div class="prediction-options">
                                <input type="radio" name="winner" id="win1-${match.id}" value="${match.team1.name}" required><label for="win1-${match.id}">${match.team1.name}</label>
                                <input type="radio" name="winner" id="draw-${match.id}" value="تعادل"><label for="draw-${match.id}">تعادل</label>
                                <input type="radio" name="winner" id="win2-${match.id}" value="${match.team2.name}"><label for="win2-${match.id}">${match.team2.name}</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <legend>من سيسجل أولاً؟ (اختياري)</legend>
                            <input type="text" name="scorer" class="scorer-input" placeholder="اكتب اسم اللاعب...">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="submit-btn">${isMatchOver ? 'أغلقت التوقعات' : 'إرسال التوقع'}</button>
                        </div>
                    </form>
                </div>
                <div class="match-footer">
                    <button class="toggle-comments-btn" ${isMatchOver ? 'disabled' : ''}>💬 التعليقات</button>
                    <div class="comments-section" style="display:none;">
                        <div class="comment-list"></div>
                        <form name="match-comment-form" class="comment-form" data-netlify="true">
                            <input type="hidden" name="form-name" value="match-comment-form" />
                            <input type="hidden" name="match_name" value="${matchName}" />
                            <textarea name="comment_text" placeholder="أضف تعليقك..." required></textarea>
                            <button type="submit">إرسال</button>
                        </form>
                    </div>
                </div>
            `; 
            dayContentContainer.appendChild(card); 
        }); 
    }

    function attachTabEventListeners() { 
        const dateTabsContainer = document.getElementById('date-tabs');
        dateTabsContainer.addEventListener('click', (e) => { 
            if (!e.target.classList.contains('date-tab')) return; 
            const tabId = e.target.dataset.tabId; 
            document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active')); 
            e.target.classList.add('active'); 
            document.querySelectorAll('.day-content').forEach(content => content.classList.remove('active')); 
            document.getElementById(`day-${tabId}`).classList.add('active'); 
        }); 
    }
            
    function attachMatchEventListeners() { 
        const daysContentContainer = document.getElementById('days-content-container');
        const userIconBtn = document.getElementById('user-icon-btn'); 
        const dismissIconBtn = document.getElementById('dismiss-icon-btn'); 
        const closeModalBtn = document.getElementById('close-modal-btn'); 
        const userModal = document.getElementById('user-modal'); 
        const userInfoForm = document.getElementById('user-info-form'); 
        userIconBtn.addEventListener('click', openUserModal); 
        dismissIconBtn.addEventListener('click', dismissFloatingIcon); 
        closeModalBtn.addEventListener('click', closeUserModal); 
        userModal.addEventListener('click', (e) => { if (e.target === userModal) closeUserModal(); }); 
        userInfoForm.addEventListener('submit', saveUserInfo); 
        daysContentContainer.addEventListener('submit', e => { 
            e.preventDefault();
            if (e.target.classList.contains('prediction-form') || e.target.classList.contains('comment-form')) { 
                handleFormSubmit(e.target); 
            }
        }); 
        daysContentContainer.addEventListener('click', e => { 
            if (e.target.classList.contains('toggle-comments-btn')) handleToggleComments(e.target); 
        }); 
    }

    function openUserModal() { document.getElementById('user-modal').classList.add('show'); }
    function closeUserModal() { document.getElementById('user-modal').classList.remove('show'); }
    function dismissFloatingIcon() { document.getElementById('floating-icon-container').classList.add('hidden'); sessionStorage.setItem('isIconDismissed', 'true'); }
    
    function saveUserInfo(e) { 
        e.preventDefault(); 
        const userModal = document.getElementById('user-modal'); 
        const saveStatus = document.getElementById('save-status'); 
        const userInfo = { username: userModal.querySelector('#username').value.trim(), social: userModal.querySelector('#social_account').value.trim() }; 
        if (!userInfo.username) { alert('الرجاء إدخال اسم المستخدم.'); return; } 
        localStorage.setItem('userInfo', JSON.stringify(userInfo)); 
        saveStatus.textContent = 'تم الحفظ ✅'; 
        setTimeout(() => { saveStatus.textContent = ''; closeUserModal(); }, 1500); 
    }
    
    function loadUserInfo() { const userInfo = JSON.parse(localStorage.getItem('userInfo')); if (userInfo) { document.getElementById('username').value = userInfo.username || ''; document.getElementById('social_account').value = userInfo.social || ''; } }
    
    function populateTicker() { 
        const tickerMessages = ["🏆 سيتم تكريم أفضل المتوقعين في نهاية كل أسبوع!", "💡 تأكد من حفظ بياناتك للمشاركة في السحب.", "🔥 تابعونا في تغطية خاصة لمباريات كأس العالم للأندية."];
        document.getElementById('predictions-ticker-content').innerHTML = tickerMessages.map(msg => `<span class="ticker-item">${msg}</span>`).join(''); 
    }
    
    function handleFormSubmit(form) {
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
        submitBtn.disabled = true;

        const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
        const formData = new FormData(form);
        formData.append('username', userInfo.username || 'مجهول');
        formData.append('social_account', userInfo.social || 'لا يوجد');

        fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData).toString(),
        })
        .then(() => {
            if (form.classList.contains('prediction-form')) {
                submitBtn.innerHTML = `تم الإرسال ✅`;
                [...form.elements].forEach(el => el.disabled = true);
                const matchCard = form.closest('.match-card');
                const prediction = { 
                    winner: form.querySelector('input[name="winner"]:checked').value,
                    scorer: form.querySelector('input[name="scorer"]').value.trim() 
                };
                localStorage.setItem(`prediction-${matchCard.dataset.matchId}`, JSON.stringify(prediction));
            } else if (form.classList.contains('comment-form')) {
                submitBtn.innerHTML = "إرسال";
                submitBtn.disabled = false;
                const matchCard = form.closest('.match-card');
                const commentList = form.closest('.comments-section').querySelector('.comment-list');
                const commentText = form.querySelector('textarea').value;
                const commentData = { author: userInfo.username || 'مجهول', text: commentText };
                addCommentToDOM(commentList, commentData);
                const comments = JSON.parse(localStorage.getItem(`comments-${matchCard.dataset.matchId}`) || '[]');
                comments.push(commentData);
                localStorage.setItem(`comments-${matchCard.dataset.matchId}`, JSON.stringify(comments));
                form.querySelector('textarea').value = '';
            }
        })
        .catch((error) => {
            alert('حدث خطأ. الرجاء المحاولة مرة أخرى.');
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
    }

    function handleToggleComments(button) { const commentsSection = button.nextElementSibling; const isHidden = commentsSection.style.display === 'none' || !commentsSection.style.display; commentsSection.style.display = isHidden ? 'block' : 'none'; button.innerHTML = isHidden ? '💬 إخفاء التعليقات' : '💬 التعليقات'; }
    
    function addCommentToDOM(commentList, commentData) { 
        const newComment = document.createElement('div'); 
        newComment.className = 'comment'; 
        newComment.innerHTML = `<div class="comment-avatar"><i class="fa-solid fa-user"></i></div><div class="comment-body"><span class="comment-author">${commentData.author}</span><p class="comment-text">${commentData.text}</p></div>`; 
        commentList.appendChild(newComment); 
    }
    
    function loadFromStorage() { 
        document.querySelectorAll('.match-card').forEach(card => { 
            const matchId = card.dataset.matchId; 
            const savedPrediction = localStorage.getItem(`prediction-${matchId}`); 
            if (savedPrediction) { 
                const prediction = JSON.parse(savedPrediction); 
                const form = card.querySelector('.prediction-form'); 
                const winnerInput = form.querySelector(`input[value="${prediction.winner}"]`); 
                if (winnerInput) winnerInput.checked = true; 
                form.querySelector('.scorer-input').value = prediction.scorer; 
                [...form.elements].forEach(el => el.disabled = true); 
                form.querySelector('.submit-btn').innerHTML = 'تم الإرسال ✅'; 
            } 
            const savedComments = JSON.parse(localStorage.getItem(`comments-${matchId}`) || '[]'); 
            const commentList = card.querySelector('.comment-list'); 
            savedComments.forEach(comment => addCommentToDOM(commentList, comment)); 
        }); 
    }
            
    // --- الدالة الرئيسية التي تشغل كل شيء ---
    function initializePredictionsPage() {
        const floatingIconContainer = document.getElementById('floating-icon-container');

        // الكود الذي كان هنا سابقاً، تم نقله إلى دالة منفصلة
        const manualMatchesData = [
             { "id": 2301, "team1": { "name": "مانشستر سيتي", "logo": "https://media.api-sports.io/football/teams/50.png" }, "team2": { "name": "العين", "logo": "https://cdn.sportfeeds.io/sdl/images/team/crest/medium/2sHjUCuU5YFqVTNH4hDhu.png?quality=60&auto=webp&format=pjpg" }, "league": "كأس العالم للأندية", "datetime": "2025-06-23T02:00:00+01:00", "channels": ["DAZN"] },
             { "id": 2302, "team1": { "name": "أتلتيكو مدريد", "logo": "https://media.api-sports.io/football/teams/530.png" }, "team2": { "name": "بوتافوغو", "logo": "https://media.api-sports.io/football/teams/1081.png" }, "league": "كأس العالم للأندية", "datetime": "2025-06-23T20:00:00+01:00", "channels": ["DAZN"] }
        ];

        // هذا هو الاستدعاء الذي كان ناقصًا!
        initializeAppWithData(manualMatchesData);
    }
    
    // ==========================================================
    // SECTION 2: NEWS PAGE LOGIC (STABLE VERSION)
    // ==========================================================
    function initializeNewsPage() {
        // ... كل كود صفحة الأخبار يبقى كما هو ...
        const ADMIN_PASSWORD = '1122';
        const getTodaysDateString = (offsetDays=0)=>{const today = new Date();today.setDate(today.getDate() - offsetDays);const yyyy = today.getFullYear();const mm = String(today.getMonth() + 1).padStart(2, '0');const dd = String(today.getDate()).padStart(2, '0');return `${yyyy}-${mm}-${dd}`};
        let articlesData = [
            {"id":5,"title":"إستيفاو ويليان.. أكثر لاعب محظوظ في العالم!","image":"https://f.top4top.io/p_3462yrvqf0.jpg","publishDate":"2025-06-24","badge":"hot","fullText":"<p>في مباراة ودّية جمعت بالميراس البرازيلي وإنتر ميامي الأميركي، خطف النجم الشاب إستيفاو ويليان الأضواء بلقطة لن ينساها طيلة مسيرته.</p><p>ويليان، الذي لم يتجاوز 17 عامًا بعد، استغل فرصة مشاركته أمام أساطير اللعبة ليقوم بتبادل القمصان مع ليونيل ميسي بين شوطي اللقاء، وسط دهشة الجماهير.</p><p>لكن المفاجأة الأكبر كانت عقب نهاية المباراة، عندما توجّه مباشرة إلى لويس سواريز وتبادل القميص معه أيضًا، ليجمع بين قميصي اثنين من أعظم اللاعبين في تاريخ كرة القدم.</p><p>هذه اللحظة الاستثنائية انتشرت كالنار في الهشيم عبر مواقع التواصل، واعتبرها كثيرون دليلاً على أن النجم الصاعد يعيش حلمًا لا يعيشه سوى القلائل.</p><p>الصحافة البرازيلية وصفت الأمر بأنه \"أسبوع الأحلام\" لإستيفاو، فيما بدأ المتابعون يتساءلون: هل هو مجرد محظوظ؟ أم نجم قادم بقوة؟</p>"},
            {"id":4,"title":"سان جيرمان يتصدر.. وأتلتيكو مدريد خارج المونديال!","image":"https://e.top4top.io/p_3461all000.jpg","publishDate":"2025-06-23","badge":"hot","fullText":"<p>انتهت منافسات المجموعة الثانية في كأس العالم للأندية بنتائج مثيرة ومفاجآت مدوية، أبرزها خروج أتلتيكو مدريد من الدور الأول رغم امتلاكه نفس عدد النقاط كالمتصدرين.</p><p>النجم المغربي أشرف حكيمي قاد فريقه باريس سان جيرمان إلى الفوز الأخير الذي ضمن الصدارة بفارق الأهداف، بعد أداء قوي وتألق واضح في الجبهة اليمنى.</p><p>في المقابل، تأهل بوتافوجو البرازيلي إلى دور الـ16 رغم الخسارة، مستفيدًا من تفوقه على أتلتيكو مدريد بفارق الأهداف الإيجابي، في واحدة من أكثر السيناريوهات إثارة هذا الموسم.</p><p>أما أتلتيكو، فقد دفع ثمن البداية الضعيفة، حيث لم يشفع له الفوز الأخير بسبب فارق الأهداف السلبي الذي أبقاه في المركز الثالث برصيد 6 نقاط.</p><p>سياتل الأمريكي كان الحلقة الأضعف في المجموعة، حيث ودّع البطولة دون أي نقطة بعد ثلاث هزائم متتالية وفارق أهداف كبير بلغ -5.</p>"},
            {"id":10,"title":"كابرال يرد: 'چيان لعِين' ليست عنصرية!","image":"https://b.top4top.io/p_3461gr2b90.jpg","publishDate":"2025-06-23","badge":"hot","fullText":"<p>في واحدة من أبرز لقطات كأس العالم للأندية، التقطت الكاميرات مواجهة نارية بين أنطونيو روديجر وجوستافو كابرال، بعد أن بدا أن الأول شعر بإهانة عنصرية وجهها له لاعب باتشوكا.</p><p>ردّ كابرال جاء سريعًا عبر تصريح مثير، قال فيه: 'الحكم أشار بالعنصرية، وأنا واصلت تكرار ما قلته لروديجر چيان لعِين، ولم يكن هناك أي عنصرية في ذلك، كما نقولها في الأرجنتين، إنها مجرد كلمة.'</p><p>العبارة التي استخدمها كابرال تُعد شائعة في الأرجنتين، وتُقال أحيانًا داخل الملاعب للتعبير عن التوتر أو الغضب، دون نية عنصرية، لكنها قد تحمل معانٍ مختلفة في ثقافات أخرى، ما تسبب في سوء الفهم.</p><p>الجماهير تفاعلت بقوة مع المشهد، بين من يرى أن على اللاعبين احترام اختلاف الخلفيات، ومن يدافع عن كابرال مؤكدين أنه لم يقصد الإساءة، خاصة وأن روديجر معروف بحساسيته تجاه قضايا العنصرية بعد تجارب مؤلمة سابقة.</p><p>الحادثة تفتح مجددًا ملف التواصل بين الثقافات في الملاعب الدولية، وتؤكد أن كرة القدم، رغم كونها عالمية، تحتاج إلى حساسية مضاعفة تجاه ما يُقال داخل المستطيل الأخضر.</p>"},
            {"id":3,"title":"الهلال يقترب من حسم صفقة تيو هيرنانديز","image":"https://j.top4top.io/p_3461lgsle0.jpg","fullText":"<p>أكد الصحفي الموثوق فابريزيو رومانو أن نادي الهلال السعودي بات قريبًا للغاية من التوقيع مع النجم الفرنسي تيو هيرنانديز، الظهير الأيسر لنادي ميلان الإيطالي. المفاوضات دخلت مراحلها النهائية بعد أن وافق اللاعب على الشروط الشخصية.</p><p>الهلال أبدى جدية كبيرة في المفاوضات، حيث قدم عرضًا مغريًا لميلان يتجاوز 70 مليون يورو، وهو ما جعل النادي الإيطالي يدرس العرض بجدية، خاصة في ظل حاجته لتمويل صفقات أخرى. تيو هيرنانديز يُعد من أفضل اللاعبين في مركزه خلال السنوات الأخيرة، وساهم بشكل كبير في تتويج ميلان بلقب الدوري الإيطالي موسم 2021-2022. في حال إتمام الصفقة، سيُشكل تيو إضافة نوعية لدفاع وهجوم الهلال في الموسم المقبل الذي يشهد مشاركات عالمية.</p>"}
        ];
        const newsHomePage=document.querySelector('#news-page #home-page');const newsArticlePage=document.querySelector('#news-page #article-page');const articlesGrid=document.querySelector('#news-page #articles-grid');const articleContent=document.querySelector('#news-page #article-content');const notificationToast=document.querySelector('#news-page #notification-toast');const exitToast=document.getElementById('exit-toast');let currentArticleId=null;let currentNewsSubPage='home';let firstBackPressTime=0;function showToast(message,type='success',duration=3000){notificationToast.textContent=message;notificationToast.className=`show ${type}`;setTimeout(()=>{notificationToast.classList.remove('show')},duration)}function navigateToNewsSubPage(pageName){currentNewsSubPage=pageName;if(pageName==='article'){newsHomePage.style.transform='translateX(-100%)';newsArticlePage.style.transform='translateX(0)'}else{newsHomePage.style.transform='translateX(0)';newsArticlePage.style.transform='translateX(100%)'}}function showArticle(articleId){const article=articlesData.find(a=>a.id===articleId);if(!article)return;currentArticleId=article.id;if(typeof gtag!=='undefined'){gtag('event','view_item',{'item_name':article.title})}articleContent.innerHTML=`
                    <div id="article-header">
                        <h1>${article.title}</h1>
                        <button id="share-button" title="مشاركة الخبر"><i class="fa-solid fa-share-nodes"></i></button>
                    </div>
                    <img src="${article.image}" alt="${article.title}">
                    ${article.fullText}
                `;document.getElementById('article-title-hidden-input').value=article.title;document.getElementById('share-button').addEventListener('click',()=>{if(typeof gtag!=='undefined'){gtag('event','share',{'method':'Native/Clipboard','content_type':'article','item_id':article.title})}const shareData={title:article.title,text:`شاهد هذا الخبر: ${article.title}`,url:window.location.href};if(navigator.share){navigator.share(shareData).catch(console.error)}else{navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(()=>showToast('تم نسخ رابط الخبر!')).catch(err=>alert('فشل نسخ الرابط.'))}});loadComments(currentArticleId);newsArticlePage.scrollTop=0;navigateToNewsSubPage('article')}function buildHomePage(){articlesGrid.innerHTML='';articlesData.forEach(article=>{const card=document.createElement('div');card.className='article-card';card.innerHTML=`<img src="${article.image}" alt="${article.title}"><div class="article-title"><h3>${article.title}</h3></div>`;card.addEventListener('click',()=>showArticle(article.id));articlesGrid.appendChild(card)})}function loadComments(articleId){const commentsList=document.querySelector('#news-page #comments-list');const comments=JSON.parse(localStorage.getItem(`comments_${articleId}`))||[];commentsList.innerHTML='';if(comments.length===0){commentsList.innerHTML='<p style="color: var(--secondary-text-color); text-align: center;">لا توجد تعليقات. كن أول من يعلق!</p>';return}comments.slice().reverse().forEach(comment=>{const commentElement=document.createElement('div');commentElement.className='comment-item';const safeAuthor=document.createTextNode(comment.name||'مجهول').textContent;const safeText=document.createTextNode(comment.text).textContent;const commentDate=new Date(comment.date).toLocaleString('ar-EG',{dateStyle:'short',timeStyle:'short'});commentElement.innerHTML=`<button class="delete-comment-btn" onclick="handleNewsDeleteComment(${articleId},'${comment.date}')" title="حذف التعليق"><i class="fa-solid fa-trash"></i></button><div class="comment-header"><span class="comment-author">${safeAuthor}</span><span class="comment-date">${commentDate}</span></div><p class="comment-body">${safeText}</p>`;commentsList.appendChild(commentElement)})}function handleNewsCommentSubmit(event){event.preventDefault();const form=event.target;const nameInput=document.getElementById('comment-name');const textInput=document.getElementById('comment-text');const submitBtn=document.getElementById('submit-comment-btn');const name=nameInput.value.trim();const text=textInput.value.trim();if(!text)return;submitBtn.disabled=true;submitBtn.textContent='جارِ الإرسال...';const formData=new FormData(form);fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(formData).toString()}).then(()=>{const comments=JSON.parse(localStorage.getItem(`comments_${currentArticleId}`))||[];const newComment={name:name||'مجهول',text:text,date:new Date().toISOString()};comments.push(newComment);localStorage.setItem(`comments_${currentArticleId}`,JSON.stringify(comments));loadComments(currentArticleId);showToast('تم إرسال تعليقك بنجاح!')}).catch(error=>{showToast('فشل إرسال التعليق.','error')}).finally(()=>{submitBtn.disabled=false;submitBtn.textContent='إرسال التعليق';nameInput.value='';textInput.value=''})}window.handleNewsDeleteComment=function(articleId,commentDate){const password=prompt("للتحقق، يرجى إدخال كلمة مرور المدير:");if(password===ADMIN_PASSWORD){let comments=JSON.parse(localStorage.getItem(`comments_${articleId}`))||[];comments=comments.filter(c=>c.date!==commentDate);localStorage.setItem(`comments_${articleId}`,JSON.stringify(comments));loadComments(articleId);showToast('تم حذف التعليق بنجاح.')}else if(password!==null){alert("كلمة المرور غير صحيحة!")}}document.querySelector('#news-page #comment-form').addEventListener('submit',handleNewsCommentSubmit);let touchStartX=0;let isSwiping=false;newsArticlePage.addEventListener('touchstart',e=>{if(e.changedTouches[0].screenX<50||e.changedTouches[0].screenX>window.innerWidth-50){touchStartX=e.changedTouches[0].screenX;isSwiping=true}});newsArticlePage.addEventListener('touchend',e=>{if(!isSwiping)return;isSwiping=false;const touchEndX=e.changedTouches[0].screenX;const swipeDistance=Math.abs(touchEndX-touchStartX);if(swipeDistance>75){navigateToNewsSubPage('home')}});document.addEventListener('backbutton',e=>{e.preventDefault();const newsPage=document.getElementById('news-page');if(!newsPage.classList.contains('hidden')&¤tNewsSubPage==='article'){navigateToNewsSubPage('home')}else{if(new Date().getTime()-firstBackPressTime<2000){if(navigator.app&&navigator.app.exitApp){navigator.app.exitApp()}}else{firstBackPressTime=new Date().getTime();exitToast.classList.add('show');setTimeout(()=>{exitToast.classList.remove('show')},2000)}}},false);buildHomePage();
    }

</script>
</body>
</html>
