<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - وضع التشخيص</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0d1117; --bg-medium: #161b22; --border-color: #30363d;
            --text-primary: #c9d1d9; --text-secondary: #8b949e; --accent-blue: #2f81f7;
            --accent-red: #da3633; --accent-yellow: #f7b731; --accent-green: #238636;
        }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg-dark); color: var(--text-primary); }
        .container { max-width: 1600px; margin: 2rem auto; padding: 0 2rem; }
        .card { background-color: var(--bg-medium); border-radius: 8px; border: 1px solid var(--border-color); padding: 1.5rem; }
        h1, h2, h3 { color: white; border-bottom: 1px solid var(--border-color); padding-bottom: 0.75rem; margin-bottom: 1.5rem; font-weight: 700; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-secondary); }
        input, textarea, select { width: 100%; padding: 0.75rem; background-color: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); }
        .hidden { display: none; }
        .tab-button.active { background-color: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        .tab-content.active { display: block; }
        .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1rem; }
        .item-card { background-color: var(--bg-dark); padding: 1rem; border-radius: 6px; border: 1px solid var(--border-color); }
        .item-card-footer { margin-top: 1rem; display: flex; gap: 0.5rem; border-top: 1px solid var(--border-color); padding-top: 1rem; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.active { display: flex; }
        .modal-content { background-color: var(--bg-medium); padding: 2rem; border-radius: 8px; width: 90%; max-width: 800px; border: 1px solid var(--border-color); max-height: 90vh; overflow-y: auto; }
        .loader { width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Add other styles back if needed, keeping it minimal for debugging */
    </style>
</head>
<body>

    <div id="login-screen" class="container max-w-md text-center card mt-20">
        <h1 class="text-2xl">تسجيل الدخول</h1>
        <input type="password" id="password-input" placeholder="كلمة المرور" class="mt-4 text-center">
        <button id="login-button" class="mt-2 w-full"><i class="fas fa-sign-in-alt"></i> دخول</button>
    </div>

    <div id="admin-panel" class="container hidden">
        <h1 class="text-3xl">لوحة التحكم تعمل!</h1>
        <!-- The rest of the admin panel is here, but hidden for now -->
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- رسالة التنبيه رقم 1 ---
        // إذا رأيت هذه الرسالة، فهذا يعني أن الصفحة تم تحميلها والسكريبت بدأ بالعمل.
        alert("1. السكريبت بدأ بالعمل.");

        // ==================== CONFIG & SETUP ====================
        const ADMIN_PASSWORD = '1122'; // <--- تأكد 100% أن هذه هي كلمة المرور التي تدخلها
        const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';
        
        let supabase;
        try {
            supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } catch (e) {
            alert('خطأ فادح: فشل الاتصال بـ Supabase. تأكد من أن مفاتيحك صحيحة وأن مكتبة Supabase تم تحميلها.');
            return;
        }

        // ==================== DOM ELEMENTS ====================
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginButton = document.getElementById('login-button');
        const passwordInput = document.getElementById('password-input');
        
        // التحقق من وجود العناصر الأساسية
        if (!loginScreen || !adminPanel || !loginButton || !passwordInput) {
            alert("خطأ فادح: أحد عناصر واجهة المستخدم الرئيسية (مثل زر الدخول أو حقل كلمة المرور) غير موجود في الصفحة. تأكد من أن معرفات HTML (id) صحيحة.");
            return; // أوقف تنفيذ السكريبت
        }

        // --- رسالة التنبيه رقم 2 ---
        // إذا رأيت هذه الرسالة، فهذا يعني أن السكريبت وجد زر الدخول وحقل كلمة المرور بنجاح.
        alert("2. تم العثور على عناصر الدخول.");

        // ==================== AUTH FUNCTION (with alerts) ====================
        const login = () => {
            // --- رسالة التنبيه رقم 3 ---
            // إذا رأيت هذه الرسالة، فهذا يعني أن الضغط على الزر يعمل وينفذ وظيفة login.
            alert("3. تم استدعاء وظيفة الدخول.");

            const enteredPassword = passwordInput.value.trim();
            const correctPassword = ADMIN_PASSWORD;

            // --- رسالة التنبيه رقم 4 ---
            // هذه أهم رسالة، ستظهر لك ما كتبته بالضبط وما هي الكلمة الصحيحة.
            alert(`4. كلمة المرور المدخلة: [${enteredPassword}]\nكلمة المرور الصحيحة: [${correctPassword}]`);

            if (enteredPassword === correctPassword) {
                // --- رسالة التنبيه رقم 5 (نجاح) ---
                alert("5. كلمة المرور صحيحة! سيتم الآن إظهار لوحة التحكم.");
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'block';
                // بعد التأكد من نجاح الدخول، سنعيد تفعيل الكود الكامل
                // loadAllData(); 
            } else {
                // --- رسالة التنبيه رقم 5 (فشل) ---
                alert("5. كلمة المرور غير صحيحة.");
            }
        };

        loginButton.addEventListener('click', login);
        passwordInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });

        // تم تبسيط الكود للتركيز على مشكلة الدخول.
        // سيتم إعادة إضافة باقي الدوال بعد حل هذه المشكلة.
    });
    </script>
</body>
</html>
