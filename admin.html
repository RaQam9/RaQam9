<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - تشخيص</title>
    <!-- ... باقي الـ head يبقى كما هو ... -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ... كل CSS يبقى كما هو ... */
        body { font-family: 'Tajawal', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .container { max-width: 900px; margin: 2rem auto; padding: 2rem; background-color: #161b22; border-radius: 8px; border: 1px solid #30363d;}
        .error-box { background-color: #2d1a1a; border: 1px solid #da3633; color: #ff9a9a; padding: 15px; border-radius: 8px; margin: 10px; font-family: monospace; text-align: left; direction: ltr; white-space: pre-wrap; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login-screen" class="container text-center">
        <h1 class="text-2xl font-bold">تسجيل الدخول</h1>
        <input type="password" id="password-input" placeholder="كلمة المرور" class="mt-4 text-center">
        <button id="login-button" class="mt-2 w-full">دخول</button>
    </div>

    <div id="admin-panel" class="container hidden">
        <!-- ... بقية HTML يبقى كما هو ... -->
         <h1 class="text-3xl font-bold mb-4">لوحة التحكم الشاملة</h1>
        <div class="tabs flex gap-2 mb-4">
            <button class="tab-button active" data-tab="matches">إدارة المباريات</button>
            <button class="tab-button" data-tab="articles">إدارة المقالات</button>
        </div>
        <div id="tab-matches" class="tab-content active">
            <h2 class="text-2xl font-bold">المباريات</h2>
            <ul id="matches-list" class="mt-4 item-list"></ul>
        </div>
        <div id="tab-articles" class="tab-content">
            <h2 class="text-2xl font-bold">المقالات</h2>
            <ul id="articles-list" class="mt-4 item-list"></ul>
        </div>
    </div>
    
    <div id="edit-modal" class="modal-overlay hidden">
         <!-- ... HTML الخاص بالـ Modal يبقى كما هو ... -->
    </div>

    <!-- مكان مخصص لعرض الأخطاء العامة -->
    <div id="error-container" class="container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // --- الإعدادات والمتغيرات ---
                const ADMIN_PASSWORD = '1122';
                const SUPABASE_URL = 'https://uxtxavurcgdeueeemmdi.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dHhhdnVyY2dkZXVlZWVtbWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMjQ4NzYsImV4cCI6MjA2NjYwMDg3Nn0.j7MrIoGzbzjurKyWGN0GgpMBIzl5exOsZrYlKCSmNbk';
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                // --- عناصر الصفحة ---
                const loginScreen = document.getElementById('login-screen');
                const adminPanel = document.getElementById('admin-panel');
                const loginButton = document.getElementById('login-button');
                const matchesList = document.getElementById('matches-list');
                const articlesList = document.getElementById('articles-list');
                const errorContainer = document.getElementById('error-container');

                if (!loginScreen || !adminPanel || !loginButton || !matchesList || !articlesList) {
                    throw new Error("عنصر أو أكثر من عناصر الصفحة الأساسية غير موجود في HTML.");
                }

                // --- دالة تسجيل الدخول ---
                function login() {
                    const passwordInput = document.getElementById('password-input');
                    if (passwordInput.value === ADMIN_PASSWORD) {
                        loginScreen.classList.add('hidden');
                        adminPanel.classList.remove('hidden');
                        errorContainer.classList.add('hidden'); // إخفاء صندوق الأخطاء عند النجاح
                        loadMatches();
                        loadArticles();
                    } else {
                        alert('كلمة المرور غير صحيحة!');
                    }
                }
                loginButton.addEventListener('click', login);
                document.getElementById('password-input').addEventListener('keypress', (e) => e.key === 'Enter' && login());

                // --- دالة تحميل المباريات ---
                async function loadMatches() {
                    matchesList.innerHTML = '<li>جاري تحميل المباريات...</li>';
                    const { data, error } = await supabaseClient.from('matches').select('*').order('datetime', { ascending: false });
                    
                    if (error) {
                        matchesList.innerHTML = `<li class="error-box">فشل تحميل المباريات: ${error.message}</li>`;
                        return;
                    }

                    matchesList.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(match => {
                            const li = document.createElement('li');
                            li.innerHTML = `<span>${match.team1_name} vs ${match.team2_name}</span><div><button>تعديل</button><button>حذف</button></div>`;
                            matchesList.appendChild(li);
                        });
                    } else {
                        matchesList.innerHTML = '<li>لا توجد مباريات حالياً.</li>';
                    }
                }

                 // --- دالة تحميل المقالات (نسخة مبسطة للتشخيص) ---
                 async function loadArticles() {
                    articlesList.innerHTML = '<li>جاري تحميل المقالات...</li>';
                    const { data, error } = await supabaseClient.from('articles').select('*').order('created_at', { ascending: false });

                    if (error) {
                        articlesList.innerHTML = `<li class="error-box">فشل تحميل المقالات: ${error.message}</li>`;
                        return;
                    }
                    
                    articlesList.innerHTML = '';
                     if (data.length > 0) {
                        data.forEach(article => {
                            const li = document.createElement('li');
                            li.innerHTML = `<span>${article.title}</span><div><button>تعديل</button><button>حذف</button></div>`;
                            articlesList.appendChild(li);
                        });
                    } else {
                        articlesList.innerHTML = '<li>لا توجد مقالات حالياً.</li>';
                    }
                }
                
            } catch (error) {
                // التقاط أي خطأ يحدث أثناء إعداد الصفحة وعرضه
                const errorContainer = document.getElementById('error-container');
                errorContainer.innerHTML = `<div class="error-box"><h3>خطأ فادح في إعداد الصفحة!</h3><p>${error.message}</p><pre>${error.stack}</pre></div>`;
                console.error("Fatal Setup Error:", error);
            }
        });
    </script>
</body>
</html>
